<div class="admin-container" [class.dark-theme]="isDarkTheme">
    <!-- Боковое меню -->
    <aside class="sidemenu">
        <div class="logo-section">
            <i class="fas fa-building"></i>
            <div class="logo-text">
                <span class="logo-title">Админ<span class="accent">Панель</span></span>
                <span class="logo-subtitle">Система управления</span>
            </div>
        </div>
        
        <nav>
            <ul>
                <!-- Дашборд (доступен всем ролям) -->
                <li [class.active]="currentSection === 'dashboard'" *ngIf="hasAccessToSection('dashboard')">
                    <a routerLink="/admin" routerLinkActive="active" (click)="switchToSection('dashboard')">
                        <i class="fas fa-chart-line"></i>
                        <span>Дашборд</span>
                    </a>
                </li>
                
                <!-- Сотрудники (только для ADMIN и MANAGER) -->
                <li [class.active]="currentSection === 'employees'" *ngIf="hasAccessToSection('employees')">
                    <a routerLink="/admin/employees" routerLinkActive="active" (click)="switchToSection('employees')">
                        <i class="fas fa-users"></i>
                        <span>Сотрудники</span>
                    </a>
                </li>
                
                <!-- Объекты (только для ADMIN и MANAGER) -->
                <li [class.active]="currentSection === 'facilities'" *ngIf="hasAccessToSection('facilities')">
                    <a routerLink="/admin/facilities" routerLinkActive="active" (click)="switchToSection('facilities')">
                        <i class="fas fa-building"></i>
                        <span>Объекты</span>
                    </a>
                </li>
                
                <!-- Оборудование (для ADMIN, MANAGER, EMPLOYEE) -->
                <li [class.active]="currentSection === 'equipment'" *ngIf="hasAccessToSection('equipment')">
                    <a routerLink="/admin/equipment" routerLinkActive="active" (click)="switchToSection('equipment')">
                        <i class="fas fa-tools"></i>
                        <span>Оборудование</span>
                    </a>
                </li>
                
                <!-- Новости (доступно для всех авторизованных пользователей) -->
                <li [class.active]="currentSection === 'news'" *ngIf="hasAccessToSection('news')">
                    <a routerLink="/admin/news" routerLinkActive="active" (click)="switchToSection('news')">
                        <i class="fas fa-pen"></i>
                        <span>Новости</span>
                    </a>
                </li>
                
                <!-- Отчеты (только для ADMIN и MANAGER) -->
                <li [class.active]="currentSection === 'reports'" *ngIf="hasAccessToSection('reports')">
                    <a routerLink="/admin/reports" routerLinkActive="active" (click)="switchToSection('reports')">
                        <i class="fas fa-file-alt"></i>
                        <span>Отчеты</span>
                    </a>
                </li>
                
                <!-- Расчеты (для ADMIN, MANAGER, EMPLOYEE) -->
                <li [class.active]="currentSection === 'calculations'" *ngIf="hasAccessToSection('calculations')">
                    <a routerLink="/admin/calculations" routerLinkActive="active" (click)="switchToSection('calculations')">
                        <i class="fas fa-calculator"></i>
                        <span>Расчеты</span>
                    </a>
                </li>
                
                <!-- Финансы (для ADMIN, MANAGER) -->
                <li [class.active]="currentSection === 'finances'" *ngIf="hasAccessToSection('finances')">
                    <a routerLink="/admin/finances" routerLinkActive="active" (click)="switchToSection('finances')">
                        <i class="fas fa-chart-pie"></i>
                        <span>Финансы</span>
                    </a>
                </li>
                
                <!-- Отзывы (для ADMIN, MANAGER, EMPLOYEE) -->
                <li [class.active]="currentSection === 'reviews'" *ngIf="hasAccessToSection('reviews')">
                    <a routerLink="/admin/reviews" routerLinkActive="active" (click)="switchToSection('reviews')">
                        <i class="fas fa-comments"></i>
                        <span>Отзывы</span>
                    </a>
                </li>
                
                <!-- Обратная связь (для ADMIN, MANAGER) -->
                <li [class.active]="currentSection === 'feedback'" *ngIf="hasAccessToSection('feedback')">
                    <a routerLink="/admin/feedback" routerLinkActive="active" (click)="switchToSection('feedback')">
                        <i class="fas fa-headset"></i>
                        <span>Обратная связь</span>
                    </a>
                </li>
                
                <!-- Настройки (только для ADMIN) -->
                <li [class.active]="currentSection === 'settings'" *ngIf="hasAccessToSection('settings')">
                    <a routerLink="/admin/settings" routerLinkActive="active" (click)="switchToSection('settings')">
                        <i class="fas fa-cog"></i>
                        <span>Настройки</span>
                    </a>
                </li>
            </ul>
        </nav>

        <div class="user-section">
            <div class="user-info">
                <i class="fas fa-user-circle"></i>
                <div class="user-details">
                    <span class="user-name">{{userName || 'Пользователь'}}</span>
                    <span class="user-role">{{getRoleInRussian()}}</span>
                </div>
            </div>
            <button class="logout-btn" (click)="logout()">
                <i class="fas fa-sign-out-alt"></i>
                <span>Выйти</span>
            </button>
        </div>
    </aside>

    <!-- Основной контент -->
    <main class="content">
        <header class="header">
            <h2>{{pageTitle}}</h2>
            <div class="header-actions">
                <button class="notification-btn" title="Уведомления">
                    <i class="fas fa-bell"></i>
                    <div class="notification-badge">3</div>
                </button>
                <button class="theme-toggle" (click)="toggleTheme()" title="Сменить тему">
                    <i class="fas" [class.fa-moon]="!isDarkTheme" [class.fa-sun]="isDarkTheme"></i>
                </button>
            </div>
        </header>

        <!-- Дашборд (по умолчанию) -->
        <div *ngIf="currentSection === 'dashboard'">
            <!-- Мобильный заголовок страницы -->
            <div class="page-header mobile-only">
                <h1><i class="fas fa-chart-line"></i> Дашборд</h1>
            </div>
            <!-- Статистика -->
            <section class="overview-stats">
                <div class="stats-grid">
                    <div class="stat-card employees">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number">{{totalEmployees}}</div>
                            <div class="stat-label">Сотрудников</div>
                        </div>
                        <div class="stat-trend">
                            <i class="fas fa-arrow-up"></i>
                            +12%
                        </div>
                    </div>
                    
                    <div class="stat-card facilities">
                        <div class="stat-icon">
                            <i class="fas fa-building"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number">{{totalFacilities}}</div>
                            <div class="stat-label">Объектов</div>
                        </div>
                        <div class="stat-trend">
                            <i class="fas fa-arrow-up"></i>
                            +5%
                        </div>
                    </div>
                    
                    <div class="stat-card workload">
                        <div class="stat-icon">
                            <i class="fas fa-chart-pie"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number">{{averageWorkload}}%</div>
                            <div class="stat-label">Загрузка</div>
                        </div>
                        <div class="stat-trend neutral">
                            <i class="fas fa-minus"></i>
                            0%
                        </div>
                    </div>
                    
                    <div class="stat-card equipment">
                        <div class="stat-icon">
                            <i class="fas fa-tools"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number">{{equipments.length}}</div>
                            <div class="stat-label">Оборудования</div>
                        </div>
                        <div class="stat-trend">
                            <i class="fas fa-arrow-up"></i>
                            +8%
                        </div>
                    </div>
                </div>
            </section>

            <!-- Основной контент дашборда - новая структура -->
            <div class="dashboard-layout">
                <!-- Верхняя секция: Финансы и Быстрые действия -->
                <section class="dashboard-row top-section">
                    <!-- Финансовая сводка -->
                    <div class="dashboard-widget finance-widget large-widget">
                        <div class="widget-header">
                            <h4><i class="fas fa-chart-bar"></i> Финансовая сводка</h4>
                        </div>
                        <div class="widget-content">
                            <div class="finance-stats horizontal">
                                <div class="finance-item">
                                    <div class="finance-icon income">
                                        <i class="fas fa-arrow-up"></i>
                                    </div>
                                    <div class="finance-info">
                                        <span class="finance-amount">{{getTotalRevenue() | number:'1.0-0'}} ₽</span>
                                        <span class="finance-label">Общая выручка</span>
                                    </div>
                                </div>
                                <div class="finance-item">
                                    <div class="finance-icon expenses">
                                        <i class="fas fa-arrow-down"></i>
                                    </div>
                                    <div class="finance-info">
                                        <span class="finance-amount">{{getTotalExpenses() | number:'1.0-0'}} ₽</span>
                                        <span class="finance-label">Общие расходы</span>
                                    </div>
                                </div>
                                <div class="finance-item">
                                    <div class="finance-icon profit">
                                        <i class="fas fa-chart-line"></i>
                                    </div>
                                    <div class="finance-info">
                                        <span class="finance-amount">{{getProfit() | number:'1.0-0'}} ₽</span>
                                        <span class="finance-label">Прибыль</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Быстрые действия -->
                    <div class="dashboard-widget actions-widget compact-widget">
                        <div class="widget-header">
                            <h4><i class="fas fa-bolt"></i> Быстрые действия</h4>
                        </div>
                        <div class="widget-content">
                            <div class="quick-actions compact">
                                <button class="action-btn" (click)="onAddEmployee()">
                                    <i class="fas fa-user-plus"></i>
                                    <span>Добавить сотрудника</span>
                                </button>
                                <button class="action-btn" (click)="onAddFacility()">
                                    <i class="fas fa-building"></i>
                                    <span>Добавить объект</span>
                                </button>
                                <button class="action-btn" (click)="onAddEquipment()">
                                    <i class="fas fa-tools"></i>
                                    <span>Добавить оборудование</span>
                                </button>
                                <button class="action-btn" (click)="onAddNews()">
                                    <i class="fas fa-newspaper"></i>
                                    <span>Создать новость</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Средняя секция: Активность и Персонал -->
                <section class="dashboard-row middle-section">
                    <!-- Последние новости -->
                    <div class="dashboard-widget news-widget">
                        <div class="widget-header">
                            <h4><i class="fas fa-newspaper"></i> Последние новости</h4>
                            <a routerLink="/admin/news" class="view-all">Все новости →</a>
                        </div>
                        <div class="widget-content">
                            <div *ngIf="newsList && newsList.length > 0; else noNews" class="news-list">
                                <div *ngFor="let news of newsList.slice(0, 3)" class="news-item">
                                    <div class="news-date">{{news.date | date:'dd MMM'}}</div>
                                    <div class="news-content">
                                        <h5>{{news.title}}</h5>
                                        <p>{{news.content.length > 80 ? (news.content | slice:0:80) + '...' : news.content}}</p>
                                    </div>
                                </div>
                            </div>
                            <ng-template #noNews>
                                <div class="empty-state">
                                    <i class="fas fa-newspaper"></i>
                                    <p>Новости отсутствуют</p>
                                </div>
                            </ng-template>
                        </div>
                    </div>

                    <!-- Новые сотрудники -->
                    <div class="dashboard-widget employees-widget">
                        <div class="widget-header">
                            <h4><i class="fas fa-user-plus"></i> Новые сотрудники</h4>
                            <a routerLink="/admin/employees" class="view-all">Все сотрудники →</a>
                        </div>
                        <div class="widget-content">
                            <div *ngIf="employees && employees.length > 0; else noEmployees" class="employees-list">
                                <div *ngFor="let employee of employees.slice(0, 4)" class="employee-item">
                                    <div class="employee-avatar">
                                        <i class="fas fa-user"></i>
                                    </div>
                                    <div class="employee-info">
                                        <span class="employee-name">{{employee.name}}</span>
                                        <span class="employee-position">{{employee.position}}</span>
                                    </div>
                                    <div class="employee-date">
                                        <span>{{employee.created_at | date:'dd.MM'}}</span>
                                    </div>
                                </div>
                            </div>
                            <ng-template #noEmployees>
                                <div class="empty-state">
                                    <i class="fas fa-users"></i>
                                    <p>Сотрудники отсутствуют</p>
                                </div>
                            </ng-template>
                        </div>
                    </div>
                </section>

                <!-- Нижняя секция: Техническая информация -->
                <section class="dashboard-row bottom-section">
                    <!-- Состояние оборудования -->
                    <div class="dashboard-widget equipment-widget">
                        <div class="widget-header">
                            <h4><i class="fas fa-cogs"></i> Состояние оборудования</h4>
                            <a routerLink="/admin/equipment" class="view-all">Все оборудование →</a>
                        </div>
                        <div class="widget-content">
                            <div class="equipment-stats">
                                <div class="equipment-stat active">
                                    <div class="stat-number">{{getEquipmentByStatus('active').length}}</div>
                                    <div class="stat-label">Активное</div>
                                </div>
                                <div class="equipment-stat maintenance">
                                    <div class="stat-number">{{getEquipmentByStatus('maintenance').length}}</div>
                                    <div class="stat-label">На обслуживании</div>
                                </div>
                                <div class="equipment-stat inactive">
                                    <div class="stat-number">{{getEquipmentByStatus('inactive').length}}</div>
                                    <div class="stat-label">Неактивное</div>
                                </div>
                            </div>
                            <div *ngIf="equipments && equipments.length > 0" class="equipment-list">
                                <div *ngFor="let equipment of equipments.slice(0, 3)" class="equipment-item">
                                    <div class="equipment-status" [class]="equipment.status"></div>
                                    <div class="equipment-info">
                                        <span class="equipment-name">{{equipment.name}}</span>
                                        <span class="equipment-location">{{equipment.location}}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Последние расчеты -->
                    <div class="dashboard-widget calculations-widget">
                        <div class="widget-header">
                            <h4><i class="fas fa-calculator"></i> Последние расчеты</h4>
                            <a routerLink="/admin/calculations" class="view-all">Все расчеты →</a>
                        </div>
                        <div class="widget-content">
                            <div *ngIf="calculations && calculations.length > 0; else noCalculations" class="calculations-list">
                                <div *ngFor="let calculation of calculations.slice(0, 4)" class="calculation-item">
                                    <div class="calculation-type" [ngClass]="calculation.type">
                                        <i class="fas" [ngClass]="{
                                            'fa-ruble-sign': calculation.type === 'cost',
                                            'fa-chart-line': calculation.type === 'efficiency',
                                            'fa-tools': calculation.type === 'maintenance',
                                            'fa-video': calculation.type === 'technical'
                                        }"></i>
                                    </div>
                                    <div class="calculation-info">
                                        <span class="calculation-name">{{calculation.name}}</span>
                                        <span class="calculation-result">
                                            {{calculation.result | number:'1.0-0'}}
                                            {{calculation.type === 'efficiency' ? '%' : '₽'}}
                                        </span>
                                    </div>
                                    <div class="calculation-date">
                                        {{calculation.date | date:'dd.MM'}}
                                    </div>
                                </div>
                            </div>
                            <ng-template #noCalculations>
                                <div class="empty-state">
                                    <i class="fas fa-calculator"></i>
                                    <p>Расчеты отсутствуют</p>
                                </div>
                            </ng-template>
                        </div>
                    </div>
                </section>
            </div>
        </div>

        <!-- Финансы -->
        <div *ngIf="currentSection === 'finances'">
            <section class="finances-container">
                <!-- Заголовок и статистика -->
                <div class="finances-header">
                    <div class="finances-header-info">
                        <h3>Финансовая отчетность</h3>
                        <p>Управление доходами, расходами и бюджетом компании</p>
                    </div>
                    <div class="finance-period-selector">
                        <select [value]="selectedFinancePeriod" (change)="selectedFinancePeriod = $any($event.target).value; updateFinanceData()">
                            <option value="today">Сегодня</option>
                            <option value="week">Неделя</option>
                            <option value="month">Месяц</option>
                            <option value="quarter">Квартал</option>
                            <option value="year">Год</option>
                        </select>
                    </div>
                </div>

                <!-- Основная статистика -->
                <div class="finance-stats-grid">
                    <div class="stat-card revenue">
                        <div class="stat-icon">
                            <i class="fas fa-arrow-up"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value">{{getFinanceData('revenue') | number:'1.0-0'}} ₽</span>
                            <span class="stat-label">Доходы</span>
                            <span class="stat-change positive">+12.5%</span>
                        </div>
                    </div>

                    <div class="stat-card expenses">
                        <div class="stat-icon">
                            <i class="fas fa-arrow-down"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value">{{getFinanceData('expenses') | number:'1.0-0'}} ₽</span>
                            <span class="stat-label">Расходы</span>
                            <span class="stat-change negative">+8.3%</span>
                        </div>
                    </div>

                    <div class="stat-card profit">
                        <div class="stat-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value">{{getFinanceData('profit') | number:'1.0-0'}} ₽</span>
                            <span class="stat-label">Прибыль</span>
                            <span class="stat-change positive">+18.7%</span>
                        </div>
                    </div>

                    <div class="stat-card roi">
                        <div class="stat-icon">
                            <i class="fas fa-percentage"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value">{{getROI()}}%</span>
                            <span class="stat-label">ROI</span>
                            <span class="stat-change positive">+5.2%</span>
                        </div>
                    </div>
                </div>

                <!-- График и детализация -->
                <div class="finance-charts-grid">
                    <!-- График доходов/расходов -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h4><i class="fas fa-chart-area"></i> Динамика доходов и расходов</h4>
                            <div class="chart-controls">
                                <button [class.active]="chartType === 'bar'" (click)="setChartType('bar')">
                                    <i class="fas fa-chart-bar"></i> Столбцы
                                </button>
                                <button [class.active]="chartType === 'line'" (click)="setChartType('line')">
                                    <i class="fas fa-chart-line"></i> Линия
                                </button>
                                <button [class.active]="chartType === 'area'" (click)="setChartType('area')">
                                    <i class="fas fa-chart-area"></i> Область
                                </button>
                            </div>
                        </div>
                        <div class="chart-placeholder">
                            <!-- Минималистичный столбчатый график -->
                            <div class="minimal-chart" *ngIf="chartType === 'bar'">
                                <div class="chart-legend">
                                    <span class="legend-item revenue"><span class="legend-color"></span>Доходы</span>
                                    <span class="legend-item expenses"><span class="legend-color"></span>Расходы</span>
                                </div>
                                <div class="chart-area">
                                    <div class="chart-grid">
                                        <div class="grid-line"></div>
                                        <div class="grid-line"></div>
                                        <div class="grid-line"></div>
                                        <div class="grid-line"></div>
                                    </div>
                                    <div class="chart-bars-container">
                                        <div class="chart-bar" 
                                             *ngFor="let data of getChartData()" 
                                             [style.height.%]="data.revenue"
                                             [class.expense]="false">
                                            <div class="chart-bar-value">{{(data.revenue * 10000) | number:'1.0-0'}} ₽</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="chart-labels">
                                    <div class="chart-label" *ngFor="let data of getChartData()">{{data.label}}</div>
                                </div>
                            </div>

                            <!-- Линейный график -->
                            <div class="line-chart" *ngIf="chartType === 'line'">
                                <svg viewBox="0 0 400 200">
                                    <defs>
                                        <linearGradient id="areaGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                            <stop offset="0%" style="stop-color:#10b981;stop-opacity:0.3"/>
                                            <stop offset="100%" style="stop-color:#10b981;stop-opacity:0"/>
                                        </linearGradient>
                                    </defs>
                                    <path class="chart-area-fill" d="M50,150 L100,120 L150,100 L200,80 L250,90 L350,60 L350,180 L50,180 Z"/>
                                    <path class="chart-line" d="M50,150 L100,120 L150,100 L200,80 L250,90 L350,60"/>
                                    <circle class="chart-point" cx="50" cy="150" r="4"/>
                                    <circle class="chart-point" cx="100" cy="120" r="4"/>
                                    <circle class="chart-point" cx="150" cy="100" r="4"/>
                                    <circle class="chart-point" cx="200" cy="80" r="4"/>
                                    <circle class="chart-point" cx="250" cy="90" r="4"/>
                                    <circle class="chart-point" cx="350" cy="60" r="4"/>
                                </svg>
                            </div>

                            <!-- Область график -->
                            <div class="line-chart" *ngIf="chartType === 'area'">
                                <svg viewBox="0 0 400 200">
                                    <defs>
                                        <linearGradient id="areaGradient2" x1="0%" y1="0%" x2="0%" y2="100%">
                                            <stop offset="0%" style="stop-color:#e91e63;stop-opacity:0.4"/>
                                            <stop offset="100%" style="stop-color:#e91e63;stop-opacity:0"/>
                                        </linearGradient>
                                    </defs>
                                    <path class="chart-area-fill" style="fill: url(#areaGradient2);" d="M50,150 Q100,120 150,100 T250,90 L350,60 L350,180 L50,180 Z"/>
                                    <path class="chart-line" style="stroke: #e91e63;" d="M50,150 Q100,120 150,100 T250,90 L350,60"/>
                                    <circle class="chart-point" style="fill: #e91e63;" cx="50" cy="150" r="4"/>
                                    <circle class="chart-point" style="fill: #e91e63;" cx="150" cy="100" r="4"/>
                                    <circle class="chart-point" style="fill: #e91e63;" cx="250" cy="90" r="4"/>
                                    <circle class="chart-point" style="fill: #e91e63;" cx="350" cy="60" r="4"/>
                                </svg>
                            </div>

                            <!-- Старый график для совместимости -->
                            <div class="mock-chart" *ngIf="!['bar', 'line', 'area'].includes(chartType)">
                                <div class="chart-legend">
                                    <span class="legend-item revenue"><span class="legend-color"></span>Доходы</span>
                                    <span class="legend-item expenses"><span class="legend-color"></span>Расходы</span>
                                </div>
                                <div class="chart-bars">
                                    <div class="bar-group" *ngFor="let month of getChartData()">
                                        <div class="revenue-bar" [style.height.%]="month.revenue"></div>
                                        <div class="expenses-bar" [style.height.%]="month.expenses"></div>
                                        <span class="bar-label">{{month.label}}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Структура доходов -->
                    <div class="revenue-breakdown">
                        <div class="breakdown-header">
                            <h4><i class="fas fa-pie-chart"></i> Структура доходов</h4>
                        </div>
                        
                        <!-- Круговая диаграмма -->
                        <div class="pie-chart" *ngIf="getRevenueBreakdown().length > 0">
                            <svg viewBox="0 0 200 200">
                                <circle cx="100" cy="100" r="80" fill="none" stroke="#e2e8f0" stroke-width="20"/>
                                <circle cx="100" cy="100" r="80" fill="none" 
                                        [attr.stroke]="getRevenueBreakdown()[0]?.color || '#10b981'" 
                                        stroke-width="20"
                                        stroke-dasharray="{{(getRevenueBreakdown()[0]?.percentage || 0) * 5.03}} 502"
                                        stroke-dashoffset="0"
                                        class="pie-slice"/>
                            </svg>
                            <div class="pie-center">
                                <div class="pie-center-value">{{(financeSummary?.totalRevenue || 0) | number:'1.0-0'}}</div>
                                <div class="pie-center-label">Общий доход</div>
                            </div>
                        </div>

                        <div class="breakdown-list">
                            <div class="breakdown-item" *ngFor="let item of getRevenueBreakdown()">
                                <div class="breakdown-info">
                                    <span class="breakdown-category" [style.background]="item.color">{{item.category}}</span>
                                    <span class="breakdown-amount">{{item.amount | number:'1.0-0'}} ₽</span>
                                </div>
                                <div class="breakdown-progress">
                                    <div class="progress-bar" [style.width.%]="item.percentage" [style.background]="item.color"></div>
                                </div>
                                <span class="breakdown-percentage">{{item.percentage}}%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Транзакции и управление -->
                <div class="finance-management">
                    <!-- Последние транзакции -->
                    <div class="transactions-section">
                        <div class="section-header">
                            <h4><i class="fas fa-exchange-alt"></i> Последние транзакции</h4>
                            <button class="add-btn" (click)="onAddTransaction()">
                                <i class="fas fa-plus"></i>
                                Добавить транзакцию
                            </button>
                        </div>
                        <div class="transactions-table">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Дата</th>
                                        <th>Описание</th>
                                        <th>Категория</th>
                                        <th>Тип</th>
                                        <th>Сумма</th>
                                        <th>Действия</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let transaction of getRecentTransactions()">
                                        <td>{{transaction.date | date:'dd.MM.yyyy'}}</td>
                                        <td>{{transaction.description}}</td>
                                        <td>
                                            <span class="category-badge" [ngClass]="transaction.category.toLowerCase()">
                                                {{transaction.category}}
                                            </span>
                                        </td>
                                        <td>
                                            <span class="transaction-type" [ngClass]="transaction.type">
                                                <i [class]="transaction.type === 'income' ? 'fas fa-arrow-up' : 'fas fa-arrow-down'"></i>
                                                {{transaction.type === 'income' ? 'Доход' : 'Расход'}}
                                            </span>
                                        </td>
                                        <td class="amount" [ngClass]="transaction.type">
                                            {{transaction.type === 'income' ? '+' : '-'}}{{transaction.amount | number:'1.0-0'}} ₽
                                        </td>
                                        <td>
                                            <div class="action-buttons">
                                                <button class="action-btn edit" (click)="editTransaction(transaction)">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                <button class="action-btn delete" (click)="deleteTransaction(transaction.id)">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Бюджет и планирование -->
                    <div class="budget-section">
                        <div class="section-header">
                            <h4><i class="fas fa-calendar-alt"></i> Бюджет</h4>
                            <button class="add-btn" (click)="onAddBudget()">
                                <i class="fas fa-plus"></i>
                                Создать бюджет
                            </button>
                        </div>
                        <div class="budget-cards">
                            <div class="budget-card" *ngFor="let budget of getBudgets()">
                                <div class="budget-header">
                                    <h5>{{budget.name}}</h5>
                                    <span class="budget-period">{{budget.period}}</span>
                                </div>
                                <div class="budget-progress">
                                    <div class="progress-info">
                                        <span>{{budget.spent | number:'1.0-0'}} ₽ из {{budget.limit | number:'1.0-0'}} ₽</span>
                                        <span class="percentage">{{(budget.spent / budget.limit * 100) | number:'1.0-0'}}%</span>
                                    </div>
                                    <div class="progress-bar">
                                        <div class="progress-fill" 
                                             [style.width.%]="budget.spent / budget.limit * 100"
                                             [ngClass]="{'warning': budget.spent / budget.limit > 0.8, 'danger': budget.spent / budget.limit > 1}">
                                        </div>
                                    </div>
                                </div>
                                <div class="budget-actions">
                                    <button class="edit-btn" (click)="editBudget(budget)">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="delete-btn" (click)="deleteBudget(budget.id)">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- Раздел сотрудников -->
        <div *ngIf="currentSection === 'employees'">
            <!-- Мобильный заголовок страницы -->
            <div class="page-header mobile-only">
                <h1><i class="fas fa-users"></i> Сотрудники</h1>
            </div>
            <section class="employees-container">
                <!-- Заголовок и статистика -->
                <div class="employees-header">
                    <div class="employees-header-info">
                        <h3>Управление сотрудниками</h3>
                        <p>Контроль персонала и управление командой компании</p>
                        <div class="employees-stats">
                            <div class="employees-stat-item">
                                <i class="fas fa-users"></i>
                                <span class="stat-number">{{employees.length}}</span>
                                <span class="stat-label">всего</span>
                            </div>
                            <div class="employees-stat-item">
                                <i class="fas fa-user-check"></i>
                                <span class="stat-number">{{getActiveEmployeesCount()}}</span>
                                <span class="stat-label">активных</span>
                            </div>
                            <div class="employees-stat-item">
                                <i class="fas fa-building"></i>
                                <span class="stat-number">{{getDepartmentsCount()}}</span>
                                <span class="stat-label">отделов</span>
                            </div>
                        </div>
                    </div>
                    <div class="employees-header-actions">
                        <div class="employees-view-toggle">
                            <button class="employees-view-btn" [class.active]="employeesView === 'cards'" (click)="setEmployeesView('cards')">
                                <i class="fas fa-th-large"></i>
                                Карточки
                            </button>
                            <button class="employees-view-btn" [class.active]="employeesView === 'list'" (click)="setEmployeesView('list')">
                                <i class="fas fa-list"></i>
                                Список
                            </button>
                        </div>
                        <button class="add-employee-btn" (click)="onAddEmployee()">
                            <i class="fas fa-user-plus"></i>
                            Добавить сотрудника
                        </button>
                    </div>
                </div>

                <!-- Фильтры и поиск -->
                <div class="employees-filters">
                    <div class="search-section">
                        <div class="search-input">
                            <i class="fas fa-search"></i>
                            <input type="text" 
                                   [value]="employeeSearchQuery" 
                                   (input)="employeeSearchQuery = $any($event.target).value; onEmployeeSearch($any($event.target).value)"
                                   placeholder="Поиск сотрудников...">
                        </div>
                    </div>
                    <div class="filter-section">
                        <select [value]="selectedDepartment" (change)="selectedDepartment = $any($event.target).value; filterEmployeesByDepartment()">
                            <option value="">Все отделы</option>
                            <option value="Администрация">Администрация</option>
                            <option value="Техническая поддержка">Техническая поддержка</option>
                            <option value="Продажи">Продажи</option>
                            <option value="Маркетинг">Маркетинг</option>
                        </select>
                        <select [value]="selectedEmployeeStatus" (change)="selectedEmployeeStatus = $any($event.target).value; filterEmployeesByStatus()">
                            <option value="">Все статусы</option>
                            <option value="active">Активные</option>
                            <option value="inactive">Неактивные</option>
                            <option value="vacation">В отпуске</option>
                        </select>
                    </div>
                </div>

                <!-- Карточки сотрудников -->
                <div *ngIf="employeesView === 'cards'" class="employees-cards-view">
                    <div class="employees-grid">
                        <div class="employee-card" *ngFor="let employee of getFilteredEmployees()">
                            <div class="card-header">
                                <div class="employee-avatar">
                                    <i class="fas fa-user"></i>
                                    <div class="status-indicator" [ngClass]="employee.status || 'active'"></div>
                                </div>
                                <div class="employee-info">
                                    <h4>{{employee.name}}</h4>
                                    <p class="position">{{employee.position}}</p>
                                    <p class="department">{{employee.department || 'Не указан'}}</p>
                                </div>
                                <div class="card-menu">
                                    <button class="menu-btn" (click)="toggleEmployeeMenu(employee)">
                                        <i class="fas fa-ellipsis-v"></i>
                                    </button>
                                    <div class="menu-dropdown" *ngIf="employee.showMenu">
                                        <button (click)="onViewEmployee(employee)">
                                            <i class="fas fa-eye"></i>Просмотр
                                        </button>
                                        <button (click)="onEditEmployee(employee)">
                                            <i class="fas fa-edit"></i>Редактировать
                                        </button>
                                        <button (click)="onSendMessage(employee)">
                                            <i class="fas fa-envelope"></i>Отправить сообщение
                                        </button>
                                        <button (click)="onDeleteEmployee(employee)" class="delete">
                                            <i class="fas fa-trash"></i>Удалить
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="card-content">
                                <div class="contact-info">
                                    <div class="contact-item">
                                        <i class="fas fa-envelope"></i>
                                        <span>{{employee.email}}</span>
                                    </div>
                                    <div class="contact-item">
                                        <i class="fas fa-phone"></i>
                                        <span>{{employee.phone}}</span>
                                    </div>
                                    <div class="contact-item">
                                        <i class="fas fa-calendar"></i>
                                        <span>{{employee.created_at | date:'dd.MM.yyyy'}}</span>
                                    </div>
                                </div>
                                <div class="card-stats">
                                    <div class="stat">
                                        <span class="value">{{employee.projectsCount || 0}}</span>
                                        <span class="label">Проектов</span>
                                    </div>
                                    <div class="stat">
                                        <span class="value">{{employee.tasksCompleted || 0}}</span>
                                        <span class="label">Задач</span>
                                    </div>
                                    <div class="stat">
                                        <span class="value">{{employee.rating || '—'}}</span>
                                        <span class="label">Рейтинг</span>
                                    </div>
                                </div>
                            </div>
                            <div class="card-footer">
                                <div class="skills">
                                    <span class="skill-tag" *ngFor="let skill of employee.skills?.slice(0, 3)">
                                        {{skill}}
                                    </span>
                                    <span class="more-skills" *ngIf="employee.skills && employee.skills.length > 3">
                                        +{{employee.skills!.length - 3}}
                                    </span>
                                </div>
                                <div class="card-actions">
                                    <button class="action-btn primary" (click)="onViewEmployee(employee)">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="action-btn secondary" (click)="onEditEmployee(employee)">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Список сотрудников -->
                <div *ngIf="employeesView === 'list'" class="employees-list-view">
                    <div class="employees-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>Сотрудник</th>
                                    <th>Должность</th>
                                    <th>Отдел</th>
                                    <th>Email</th>
                                    <th>Телефон</th>
                                    <th>Статус</th>
                                    <th>Рейтинг</th>
                                    <th>Дата приема</th>
                                    <th>Действия</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let employee of getFilteredEmployees()">
                                    <td>
                                        <div class="employee-info">
                                            <div class="avatar-small">
                                                <i class="fas fa-user"></i>
                                            </div>
                                            <div class="info">
                                                <span class="name">{{employee.name}}</span>
                                                <span class="id">ID: {{employee.id}}</span>
                                            </div>
                                        </div>
                                    </td>
                                    <td>{{employee.position}}</td>
                                    <td>{{employee.department || '—'}}</td>
                                    <td>{{employee.email}}</td>
                                    <td>{{employee.phone}}</td>
                                    <td>
                                        <span class="employee-status" [ngClass]="employee.status || 'active'">
                                            {{getEmployeeStatusName(employee.status || 'active')}}
                                        </span>
                                    </td>
                                    <td>
                                        <div class="rating">
                                            <span class="rating-value">{{employee.rating || '—'}}</span>
                                            <div class="stars" *ngIf="employee.rating">
                                                <i class="fas fa-star" *ngFor="let star of [1,2,3,4,5]" 
                                                   [class.filled]="star <= (employee.rating || 0)"></i>
                                            </div>
                                        </div>
                                    </td>
                                    <td>{{employee.created_at | date:'dd.MM.yyyy'}}</td>
                                    <td>
                                        <div class="employee-actions">
                                            <button class="action-btn view" (click)="onViewEmployee(employee)" title="Просмотр">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <button class="action-btn edit" (click)="onEditEmployee(employee)" title="Редактировать">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="action-btn message" (click)="onSendMessage(employee)" title="Сообщение">
                                                <i class="fas fa-envelope"></i>
                                            </button>
                                            <button class="action-btn delete" (click)="onDeleteEmployee(employee)" title="Удалить">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Пустое состояние -->
                <div *ngIf="getFilteredEmployees().length === 0" class="empty-employees">
                    <div class="empty-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <h4>Сотрудники не найдены</h4>
                    <p>{{employeeSearchQuery ? 'Попробуйте изменить поисковый запрос' : 'Добавьте первого сотрудника'}}</p>
                    <button class="add-first-employee-btn" (click)="onAddEmployee()">
                        <i class="fas fa-user-plus"></i>
                        Добавить сотрудника
                    </button>
                </div>
            </section>
        </div>

        <!-- Раздел объектов -->
        <div *ngIf="currentSection === 'facilities'">
            <section class="facilities-container">
                <!-- Заголовок с действиями -->
                <div class="facilities-header">
                    <div class="facilities-header-info">
                        <h3>Управление объектами</h3>
                        <p>Контроль состояния и управление недвижимостью компании</p>
                        <div class="facilities-stats">
                            <div class="facilities-stat-item">
                                <i class="fas fa-building"></i>
                                <span class="stat-number">{{facilities.length || 0}}</span>
                                <span class="stat-label">Всего</span>
                            </div>
                            <div class="facilities-stat-item">
                                <i class="fas fa-check-circle"></i>
                                <span class="stat-number">{{getFacilitiesByStatus('active').length}}</span>
                                <span class="stat-label">Активных</span>
                            </div>
                            <div class="facilities-stat-item">
                                <i class="fas fa-key"></i>
                                <span class="stat-number">{{getFacilitiesByStatus('ready_to_rent').length}}</span>
                                <span class="stat-label">К сдаче</span>
                            </div>
                        </div>
                    </div>
                    <div class="facilities-header-actions">
                        <div class="facilities-view-toggle">
                            <button class="facilities-view-btn" [class.active]="facilitiesView === 'cards'" (click)="setFacilitiesView('cards')">
                                <i class="fas fa-th-large"></i>
                                Карточки
                            </button>
                            <button class="facilities-view-btn" [class.active]="facilitiesView === 'list'" (click)="setFacilitiesView('list')">
                                <i class="fas fa-list"></i>
                                Список
                            </button>
                        </div>
                        <button class="add-facility-btn" (click)="onAddFacility()">
                            <i class="fas fa-plus"></i>
                            Добавить объект
                        </button>
                    </div>
                </div>

                <!-- Фильтры и поиск -->
                <div class="facilities-filters">
                    <div class="facilities-search">
                        <label>Поиск</label>
                        <i class="fas fa-search"></i>
                        <input type="text" 
                               [value]="facilitySearchQuery" 
                               (input)="facilitySearchQuery = $any($event.target).value; onFacilitySearch($any($event.target).value)"
                               placeholder="Поиск по названию, адресу или типу...">
                    </div>
                    <div class="facilities-filter-group">
                        <label>Тип</label>
                        <select [value]="selectedFacilityType" (change)="selectedFacilityType = $any($event.target).value; filterFacilitiesByType()">
                            <option value="">Все типы</option>
                            <option value="Офис">Офис</option>
                            <option value="Склад">Склад</option>
                            <option value="Производство">Производство</option>
                            <option value="Торговля">Торговля</option>
                        </select>
                    </div>
                    <div class="facilities-filter-group">
                        <label>Статус</label>
                        <select [value]="selectedFacilityStatus" (change)="selectedFacilityStatus = $any($event.target).value; filterFacilitiesByStatus()">
                            <option value="">Все статусы</option>
                            <option value="active">Активен</option>
                            <option value="inactive">Неактивен</option>
                            <option value="ready">Готов</option>
                            <option value="ready_to_rent">Готов к сдаче</option>
                            <option value="rented">Сдан</option>
                        </select>
                    </div>
                </div>

                <!-- Карточный вид объектов -->
                <div *ngIf="facilitiesView === 'cards'" class="facilities-cards-view">
                    <div *ngIf="!filteredFacilities || filteredFacilities.length === 0" class="empty-facilities">
                        <div class="empty-facilities-icon">
                            <i class="fas fa-building"></i>
                        </div>
                        <h4>{{facilitySearchQuery ? 'Ничего не найдено' : 'Нет объектов'}}</h4>
                        <p>{{facilitySearchQuery ? 'Попробуйте изменить критерии поиска' : 'Начните с добавления первого объекта'}}</p>
                        <button *ngIf="!facilitySearchQuery" class="add-first-facility-btn" (click)="onAddFacility()">
                            <i class="fas fa-plus"></i>
                            Добавить первый объект
                        </button>
                    </div>

                    <div class="facilities-grid" *ngIf="filteredFacilities && filteredFacilities.length > 0">
                        <div *ngFor="let facility of filteredFacilities" class="facility-card">
                            <div class="facility-card-header">
                                <div class="facility-avatar" 
                                     [class.office]="facility.type === 'Офис'"
                                     [class.warehouse]="facility.type === 'Склад'"
                                     [class.production]="facility.type === 'Производство'"
                                     [class.retail]="facility.type === 'Торговля'">
                                    <i class="fas" [ngClass]="{
                                        'fa-building': facility.type === 'Офис',
                                        'fa-warehouse': facility.type === 'Склад',
                                        'fa-industry': facility.type === 'Производство',
                                        'fa-store': facility.type === 'Торговля'
                                    }"></i>
                                </div>
                                <div class="facility-info">
                                    <h4>{{facility.name}}</h4>
                                    <span class="facility-type-badge" 
                                          [class.office]="facility.type === 'Офис'"
                                          [class.warehouse]="facility.type === 'Склад'"
                                          [class.production]="facility.type === 'Производство'"
                                          [class.retail]="facility.type === 'Торговля'">
                                        {{facility.type}}
                                    </span>
                                    <p class="facility-address">{{facility.address}}</p>
                                </div>
                                <div class="facility-card-menu">
                                    <button class="facility-menu-btn" (click)="toggleFacilityMenu(facility)">
                                        <i class="fas fa-ellipsis-v"></i>
                                    </button>
                                    <div class="facility-menu-dropdown" [class.show]="facility.showMenu">
                                        <button (click)="onDuplicateFacility(facility)">
                                            <i class="fas fa-copy"></i>
                                            Дублировать
                                        </button>
                                        <button (click)="onExportFacility(facility)">
                                            <i class="fas fa-download"></i>
                                            Экспорт
                                        </button>
                                        <button class="delete" (click)="onDeleteFacility(facility)">
                                            <i class="fas fa-trash"></i>
                                            Удалить
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="facility-card-content">
                                <div class="facility-details">
                                    <div class="facility-detail-row">
                                        <i class="fas fa-ruble-sign"></i>
                                        <span class="facility-cost">{{facility.cost | currency:'RUB':'₽':'1.0-0'}}</span>
                                    </div>
                                    <div class="facility-detail-row">
                                        <i class="fas fa-info-circle"></i>
                                        <span class="facility-status" [class]="facility.status">
                                            <ng-container [ngSwitch]="facility.status">
                                                <ng-container *ngSwitchCase="'active'">Активен</ng-container>
                                                <ng-container *ngSwitchCase="'inactive'">Неактивен</ng-container>
                                                <ng-container *ngSwitchCase="'ready'">Готов</ng-container>
                                                <ng-container *ngSwitchCase="'ready_to_rent'">Готов к сдаче</ng-container>
                                                <ng-container *ngSwitchCase="'rented'">Сдан</ng-container>
                                            </ng-container>
                                        </span>
                                    </div>
                                </div>
                            </div>

                            <div class="facility-card-footer">
                                <div class="facility-actions">
                                    <button class="facility-action-btn primary" (click)="onViewFacility(facility)">
                                        <i class="fas fa-eye"></i>
                                        Просмотр
                                    </button>
                                    <button class="facility-action-btn secondary" (click)="onEditFacility(facility)">
                                        <i class="fas fa-edit"></i>
                                        Редактировать
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Табличный вид объектов -->
                <div *ngIf="facilitiesView === 'list'" class="facilities-list-view">
                    <div *ngIf="!filteredFacilities || filteredFacilities.length === 0" class="empty-facilities">
                        <div class="empty-facilities-icon">
                            <i class="fas fa-search"></i>
                        </div>
                        <h4>{{facilitySearchQuery ? 'Ничего не найдено' : 'Нет объектов'}}</h4>
                        <p>{{facilitySearchQuery ? 'Попробуйте изменить критерии поиска' : 'Начните с добавления первого объекта'}}</p>
                    </div>

                    <div class="facilities-table" *ngIf="filteredFacilities && filteredFacilities.length > 0">
                        <table>
                            <thead>
                                <tr>
                                    <th>Объект</th>
                                    <th>Адрес</th>
                                    <th>Тип</th>
                                    <th>Стоимость</th>
                                    <th>Статус</th>
                                    <th>Действия</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let facility of filteredFacilities">
                                    <td>
                                        <div class="table-facility-info">
                                            <div class="table-facility-avatar" 
                                                 [class.office]="facility.type === 'Офис'"
                                                 [class.warehouse]="facility.type === 'Склад'"
                                                 [class.production]="facility.type === 'Производство'"
                                                 [class.retail]="facility.type === 'Торговля'">
                                                <i class="fas" [ngClass]="{
                                                    'fa-building': facility.type === 'Офис',
                                                    'fa-warehouse': facility.type === 'Склад',
                                                    'fa-industry': facility.type === 'Производство',
                                                    'fa-store': facility.type === 'Торговля'
                                                }"></i>
                                            </div>
                                            <div class="table-facility-details">
                                                <h5>{{facility.name}}</h5>
                                                <p>{{facility.type}}</p>
                                            </div>
                                        </div>
                                    </td>
                                    <td>{{facility.address}}</td>
                                    <td>
                                        <span class="facility-type-badge" 
                                              [class.office]="facility.type === 'Офис'"
                                              [class.warehouse]="facility.type === 'Склад'"
                                              [class.production]="facility.type === 'Производство'"
                                              [class.retail]="facility.type === 'Торговля'">
                                            {{facility.type}}
                                        </span>
                                    </td>
                                    <td class="facility-cost">{{facility.cost | currency:'RUB':'₽':'1.0-0'}}</td>
                                    <td>
                                        <span class="facility-status" [class]="facility.status">
                                            <ng-container [ngSwitch]="facility.status">
                                                <ng-container *ngSwitchCase="'active'">Активен</ng-container>
                                                <ng-container *ngSwitchCase="'inactive'">Неактивен</ng-container>
                                                <ng-container *ngSwitchCase="'ready'">Готов</ng-container>
                                                <ng-container *ngSwitchCase="'ready_to_rent'">Готов к сдаче</ng-container>
                                                <ng-container *ngSwitchCase="'rented'">Сдан</ng-container>
                                            </ng-container>
                                        </span>
                                    </td>
                                    <td>
                                        <div class="facility-actions">
                                            <button class="facility-action-btn primary" (click)="onViewFacility(facility)" title="Просмотр">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <button class="facility-action-btn secondary" (click)="onEditFacility(facility)" title="Редактировать">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="facility-action-btn secondary" (click)="onDeleteFacility(facility)" title="Удалить">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
        </div>

        <!-- Раздел оборудования -->
        <div *ngIf="currentSection === 'equipment'">
            <section class="equipment-container">
                <!-- Заголовок с действиями -->
                <div class="equipment-header">
                    <div class="equipment-header-info">
                        <h3><i class="fas fa-tools"></i> Управление оборудованием</h3>
                        <p>Контроль состояния и обслуживания оборудования</p>
                        <div class="equipment-stats">
                            <div class="stat-item">
                                <i class="fas fa-microchip"></i>
                                <span>Всего: {{equipments.length}}</span>
                            </div>
                            <div class="stat-item">
                                <i class="fas fa-check-circle"></i>
                                <span>Активно: {{getEquipmentByStatus('active').length}}</span>
                            </div>
                            <div class="stat-item">
                                <i class="fas fa-wrench"></i>
                                <span>На ТО: {{getEquipmentByStatus('maintenance').length}}</span>
                            </div>
                        </div>
                    </div>
                    <div class="equipment-header-actions">
                        <div class="equipment-view-toggle">
                            <button class="view-btn" [class.active]="equipmentView === 'cards'" (click)="setEquipmentView('cards')">
                                <i class="fas fa-th-large"></i>
                                Карточки
                            </button>
                            <button class="view-btn" [class.active]="equipmentView === 'list'" (click)="setEquipmentView('list')">
                                <i class="fas fa-list"></i>
                                Список
                            </button>
                        </div>
                        <button class="add-equipment-btn" (click)="onAddEquipment()">
                            <i class="fas fa-plus"></i>
                            Добавить оборудование
                        </button>
                    </div>
                </div>

                <!-- Фильтры и поиск -->
                <div class="equipment-filters">
                    <div class="equipment-search">
                        <label>Поиск</label>
                        <i class="fas fa-search"></i>
                        <input type="text" 
                               [value]="equipmentSearchQuery" 
                               (input)="equipmentSearchQuery = $any($event.target).value; onEquipmentSearch($any($event.target).value)"
                               placeholder="Поиск по названию, типу или местоположению...">
                    </div>
                    <div class="filter-group">
                        <label>Тип</label>
                        <select [value]="selectedEquipmentCategory" (change)="selectedEquipmentCategory = $any($event.target).value; filterEquipmentByCategory()">
                            <option value="">Все типы</option>
                            <option *ngFor="let type of getEquipmentTypes()" [value]="type">{{type}}</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Статус</label>
                        <select [value]="selectedEquipmentStatus" (change)="selectedEquipmentStatus = $any($event.target).value; filterEquipmentByStatus()">
                            <option value="">Все статусы</option>
                            <option value="active">Активно</option>
                            <option value="inactive">Неактивно</option>
                            <option value="maintenance">На обслуживании</option>
                        </select>
                    </div>
                </div>



                <!-- Карточный вид оборудования -->
                <div *ngIf="equipmentView === 'cards'" class="equipment-grid">
                    <div *ngFor="let equipment of getFilteredEquipment()" class="equipment-card">
                        <div class="equipment-status-badge" [class]="equipment.status">
                            {{getEquipmentStatusName(equipment.status)}}
                        </div>
                        
                        <div class="equipment-icon">
                            <i class="fas" [class.fa-desktop]="equipment.type.includes('Компьютер')"
                               [class.fa-print]="equipment.type.includes('Принтер') || equipment.type.includes('МФУ')"
                               [class.fa-network-wired]="equipment.type.includes('Сетевое')"
                               [class.fa-server]="equipment.type.includes('Сервер')"
                               [class.fa-tools]="!equipment.type.includes('Компьютер') && !equipment.type.includes('Принтер') && !equipment.type.includes('Сетевое') && !equipment.type.includes('Сервер')"></i>
                        </div>

                        <div class="equipment-info">
                            <h4>{{equipment.name}}</h4>
                            <p class="equipment-type">{{equipment.type}}</p>
                        </div>

                        <div class="equipment-details">
                            <div class="detail-row" *ngIf="equipment.cost">
                                <i class="fas fa-ruble-sign"></i>
                                <span>{{equipment.cost | number:'1.0-0'}} ₽</span>
                            </div>
                            <div class="detail-row" *ngIf="equipment.location">
                                <i class="fas fa-map-marker-alt"></i>
                                <span>{{equipment.location}}</span>
                            </div>
                            <div class="detail-row" *ngIf="equipment.purchase_date">
                                <i class="fas fa-calendar-alt"></i>
                                <span>{{equipment.purchase_date | date:'dd.MM.yyyy'}}</span>
                            </div>
                        </div>

                        <div class="equipment-description" *ngIf="equipment.description">
                            <p>{{equipment.description | slice:0:100}}{{equipment.description.length > 100 ? '...' : ''}}</p>
                        </div>

                        <div class="equipment-actions">
                            <button class="action-btn primary" (click)="onViewEquipment(equipment)">
                                <i class="fas fa-eye"></i>
                                Просмотр
                            </button>
                            <button class="action-btn secondary" (click)="onEditEquipment(equipment)">
                                <i class="fas fa-edit"></i>
                                Изменить
                            </button>
                            <div class="more-actions">
                                <button class="more-btn" (click)="toggleEquipmentMenu(equipment)">
                                    <i class="fas fa-ellipsis-v"></i>
                                </button>
                                <div class="actions-menu" [class.show]="equipment.showMenu">
                                    <button class="menu-item" (click)="onScheduleMaintenance(equipment)">
                                        <i class="fas fa-calendar-plus"></i>
                                        Запланировать ТО
                                    </button>
                                    <button class="menu-item" (click)="onDuplicateEquipment(equipment)">
                                        <i class="fas fa-copy"></i>
                                        Дублировать
                                    </button>
                                    <button class="menu-item" (click)="onExportEquipment(equipment)">
                                        <i class="fas fa-download"></i>
                                        Экспорт
                                    </button>
                                    <button class="menu-item delete" (click)="onDeleteEquipment(equipment)">
                                        <i class="fas fa-trash"></i>
                                        Удалить
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Списочный вид оборудования -->
                <div *ngIf="equipmentView === 'list'" class="equipment-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Оборудование</th>
                                <th>Тип</th>
                                <th>Стоимость</th>
                                <th>Местоположение</th>
                                <th>Дата покупки</th>
                                <th>Статус</th>
                                <th>Действия</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let equipment of getFilteredEquipment()">
                                <td>
                                    <div class="table-equipment-info">
                                        <div class="table-equipment-icon">
                                            <i class="fas" [class.fa-desktop]="equipment.type.includes('Компьютер')"
                                               [class.fa-print]="equipment.type.includes('Принтер') || equipment.type.includes('МФУ')"
                                               [class.fa-network-wired]="equipment.type.includes('Сетевое')"
                                               [class.fa-server]="equipment.type.includes('Сервер')"
                                               [class.fa-tools]="!equipment.type.includes('Компьютер') && !equipment.type.includes('Принтер') && !equipment.type.includes('Сетевое') && !equipment.type.includes('Сервер')"></i>
                                        </div>
                                        <div class="table-equipment-details">
                                            <h5>{{equipment.name}}</h5>
                                            <p>{{equipment.type}}</p>
                                        </div>
                                    </div>
                                </td>
                                <td>{{equipment.type}}</td>
                                <td>{{equipment.cost ? (equipment.cost | number:'1.0-0') + ' ₽' : 'Н/Д'}}</td>
                                <td>{{equipment.location || 'Не указано'}}</td>
                                <td>{{equipment.purchase_date ? (equipment.purchase_date | date:'dd.MM.yyyy') : 'Не указано'}}</td>
                                <td>
                                    <span class="equipment-status" [class]="equipment.status">
                                        {{getEquipmentStatusName(equipment.status)}}
                                    </span>
                                </td>
                                <td>
                                    <div class="table-actions">
                                        <button class="table-action-btn view" (click)="onViewEquipment(equipment)" title="Просмотр">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="table-action-btn edit" (click)="onEditEquipment(equipment)" title="Редактировать">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="table-action-btn maintenance" (click)="onScheduleMaintenance(equipment)" title="Запланировать ТО">
                                            <i class="fas fa-wrench"></i>
                                        </button>
                                        <button class="table-action-btn delete" (click)="onDeleteEquipment(equipment)" title="Удалить">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Пустое состояние -->
                <div *ngIf="getFilteredEquipment().length === 0" class="empty-equipment">
                    <div class="empty-icon">
                        <i class="fas fa-tools"></i>
                    </div>
                    <h4>Оборудование не найдено</h4>
                    <p>{{equipmentSearchQuery || selectedEquipmentCategory || selectedEquipmentStatus ? 
                        'Попробуйте изменить параметры поиска' : 
                        'Добавьте первое оборудование для начала работы'}}</p>
                    <button *ngIf="!equipmentSearchQuery && !selectedEquipmentCategory && !selectedEquipmentStatus" 
                            class="create-first-equipment-btn" (click)="onAddEquipment()">
                        <i class="fas fa-plus"></i>
                        Добавить первое оборудование
                    </button>
                </div>
            </section>
        </div>

        <!-- Раздел новостей -->
        <div *ngIf="currentSection === 'news'">
            <section class="news-container">
                <!-- Заголовок с действиями -->
                <div class="news-header">
                    <div class="news-header-info">
                        <h3><i class="fas fa-newspaper"></i> Управление новостями</h3>
                        <p>Создание и управление новостными публикациями</p>
                        <div class="news-stats">
                            <div class="stat-item">
                                <i class="fas fa-newspaper"></i>
                                <span>Всего: {{newsList.length}}</span>
                            </div>
                            <div class="stat-item">
                                <i class="fas fa-clock"></i>
                                <span>Сегодня: {{getRecentNewsCount()}}</span>
                            </div>
                        </div>
                    </div>
                    <div class="news-header-actions">
                        <div class="news-view-toggle">
                            <button class="view-btn" 
                                    [class.active]="newsView === 'cards'"
                                    (click)="setNewsView('cards')">
                                <i class="fas fa-th-large"></i>
                            </button>
                            <button class="view-btn" 
                                    [class.active]="newsView === 'list'"
                                    (click)="setNewsView('list')">
                                <i class="fas fa-list"></i>
                            </button>
                        </div>
                        <button class="add-news-btn" (click)="onAddNews()">
                            <i class="fas fa-plus"></i>
                            Создать новость
                        </button>
                    </div>
                </div>

                <!-- Фильтры и поиск -->
                <div class="news-filters">
                    <div class="news-search">
                        <label>Поиск</label>
                        <i class="fas fa-search"></i>
                        <input type="text" 
                               [value]="newsSearchQuery" 
                               (input)="newsSearchQuery = $any($event.target).value; onNewsSearch($any($event.target).value)"
                               placeholder="Поиск новостей...">
                    </div>
                    <div class="filter-group">
                        <label>Автор</label>
                        <select [value]="selectedNewsAuthor" (change)="selectedNewsAuthor = $any($event.target).value; filterNewsByAuthor()">
                            <option value="">Все авторы</option>
                            <option value="Администратор">Администратор</option>
                            <option value="Редактор">Редактор</option>
                            <option value="Модератор">Модератор</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Период</label>
                        <select [value]="selectedNewsPeriod" (change)="selectedNewsPeriod = $any($event.target).value; filterNewsByPeriod()">
                            <option value="">Все время</option>
                            <option value="today">Сегодня</option>
                            <option value="week">Неделя</option>
                            <option value="month">Месяц</option>
                        </select>
                    </div>
                </div>

                <!-- Карточный вид новостей -->
                <div *ngIf="newsView === 'cards'" class="news-grid">
                    <div *ngFor="let news of getFilteredNews()" class="news-card">
                        <div class="news-image">
                            <i class="fas fa-newspaper"></i>
                        </div>
                        
                        <div class="news-content">
                            <div class="news-date">
                                {{news.date | date:'dd MMM yyyy'}}
                            </div>
                            
                            <h4>{{news.title}}</h4>
                            
                            <p>{{news.content.length > 120 ? (news.content | slice:0:120) + '...' : news.content}}</p>
                            
                            <div class="news-meta">
                                <div class="news-author">
                                    <i class="fas fa-user"></i>
                                    <span>{{news.author}}</span>
                                </div>
                                <div class="news-read-time">
                                    <i class="fas fa-clock"></i>
                                    <span>{{getReadTime(news.content)}} мин</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="news-actions">
                            <button class="action-btn primary" (click)="onViewNews(news)">
                                <i class="fas fa-eye"></i>
                                Просмотр
                            </button>
                            <button class="action-btn secondary" (click)="onEditNews(news)">
                                <i class="fas fa-edit"></i>
                                Редактировать
                            </button>
                            <div class="more-actions">
                                <button class="more-btn" (click)="toggleNewsMenu(news)">
                                    <i class="fas fa-ellipsis-v"></i>
                                </button>
                                <div class="actions-menu" [class.show]="news.showMenu">
                                    <button class="menu-item" (click)="onDuplicateNews(news)">
                                        <i class="fas fa-copy"></i>
                                        Дублировать
                                    </button>
                                    <button class="menu-item" (click)="onPublishNews(news)">
                                        <i class="fas fa-share"></i>
                                        Опубликовать
                                    </button>
                                    <button class="menu-item delete" (click)="onDeleteNews(news)">
                                        <i class="fas fa-trash"></i>
                                        Удалить
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Списочный вид новостей -->
                <div *ngIf="newsView === 'list'" class="news-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Заголовок</th>
                                <th>Автор</th>
                                <th>Дата создания</th>
                                <th>Статус</th>
                                <th>Действия</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let news of getFilteredNews()">
                                <td>
                                    <div class="table-news-info">
                                        <div class="news-icon">
                                            <i class="fas fa-newspaper"></i>
                                        </div>
                                        <div class="table-news-details">
                                            <h5>{{news.title}}</h5>
                                            <p>{{news.content | slice:0:60}}...</p>
                                        </div>
                                    </div>
                                </td>
                                <td>{{news.author}}</td>
                                <td>{{news.date | date:'dd.MM.yyyy HH:mm'}}</td>
                                <td>
                                    <span class="news-status published">
                                        <i class="fas fa-check-circle"></i>
                                        Опубликована
                                    </span>
                                </td>
                                <td>
                                    <div class="table-actions">
                                        <button class="table-action-btn view" (click)="onViewNews(news)">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="table-action-btn edit" (click)="onEditNews(news)">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="table-action-btn delete" (click)="onDeleteNews(news)">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Пустое состояние -->
                <div *ngIf="getFilteredNews().length === 0" class="empty-news">
                    <div class="empty-icon">
                        <i class="fas fa-newspaper"></i>
                    </div>
                    <h4>Новости не найдены</h4>
                    <p>{{newsSearchQuery || selectedNewsAuthor || selectedNewsPeriod ? 
                        'Попробуйте изменить параметры поиска' : 
                        'Создайте первую новость для начала работы'}}</p>
                    <button *ngIf="!newsSearchQuery && !selectedNewsAuthor && !selectedNewsPeriod" 
                            class="create-first-news-btn" (click)="onAddNews()">
                        <i class="fas fa-plus"></i>
                        Создать первую новость
                    </button>
                </div>
            </section>
        </div>

        <!-- Раздел отчетов -->
        <div *ngIf="currentSection === 'reports'">
            <section class="reports-container">
                <!-- Заголовок с действиями -->
                <div class="reports-header">
                    <div class="header-info">
                        <h3><i class="fas fa-file-alt"></i> Управление отчетами</h3>
                        <p>Создавайте, редактируйте и управляйте отчетами с помощью встроенного редактора</p>
                    </div>
                    <div class="header-actions">
                        <div class="view-toggle">
                            <button [class.active]="reportsView === 'list'" (click)="setReportsView('list')">
                                <i class="fas fa-list"></i>
                                Список
                            </button>
                            <button [class.active]="reportsView === 'cards'" (click)="setReportsView('cards')">
                                <i class="fas fa-th-large"></i>
                                Карточки
                            </button>
                            <button [class.active]="reportsView === 'editor'" (click)="setReportsView('editor')">
                                <i class="fas fa-edit"></i>
                                Редактор
                            </button>
                        </div>
                        <button class="create-report-btn" (click)="onCreateNewReport()">
                            <i class="fas fa-plus"></i>
                            Создать отчет
                        </button>
                    </div>
                </div>

                <!-- Фильтры и поиск -->
                <div class="reports-filters" *ngIf="reportsView !== 'editor'">
                    <div class="search-section">
                        <div class="search-input">
                            <i class="fas fa-search"></i>
                            <input type="text" 
                                   [value]="reportSearchQuery" 
                                   (input)="reportSearchQuery = $any($event.target).value; onReportSearch($any($event.target).value)"
                                   placeholder="Поиск отчетов...">
                        </div>
                    </div>
                    <div class="filter-section">
                        <select [value]="selectedReportType" (change)="selectedReportType = $any($event.target).value; filterReportsByType()">
                            <option value="">Все типы</option>
                            <option value="financial">Финансовые</option>
                            <option value="operational">Операционные</option>
                            <option value="maintenance">Обслуживание</option>
                            <option value="analytics">Аналитика</option>
                        </select>
                        <select [value]="selectedReportStatus" (change)="selectedReportStatus = $any($event.target).value; filterReportsByStatus()">
                            <option value="">Все статусы</option>
                            <option value="draft">Черновик</option>
                            <option value="published">Опубликован</option>
                            <option value="archived">В архиве</option>
                        </select>
                    </div>
                </div>

                <!-- Список отчетов -->
                <div *ngIf="reportsView === 'list'" class="reports-list-view">
                    <div class="reports-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>Название</th>
                                    <th>Тип</th>
                                    <th>Создан</th>
                                    <th>Обновлен</th>
                                    <th>Статус</th>
                                    <th>Автор</th>
                                    <th>Размер</th>
                                    <th>Действия</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let report of getFilteredReports()">
                                    <td>
                                        <div class="report-title">
                                            <i class="fas" [ngClass]="{
                                                'fa-chart-line': report.type === 'financial',
                                                'fa-cogs': report.type === 'operational',
                                                'fa-tools': report.type === 'maintenance',
                                                'fa-chart-bar': report.type === 'analytics'
                                            }"></i>
                                            <span>{{report.title}}</span>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="report-type-badge" [ngClass]="report.type">
                                            {{getReportTypeName(report.type)}}
                                        </span>
                                    </td>
                                    <td>{{report.createdDate | date:'dd.MM.yyyy HH:mm'}}</td>
                                    <td>{{report.updatedDate | date:'dd.MM.yyyy HH:mm'}}</td>
                                    <td>
                                        <span class="report-status" [ngClass]="report.status">
                                            {{getReportStatusName(report.status)}}
                                        </span>
                                    </td>
                                    <td>{{report.author}}</td>
                                    <td>{{report.size || '—'}}</td>
                                    <td>
                                        <div class="report-actions">
                                            <button class="action-btn view" (click)="onViewReport(report)" title="Просмотр">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <button class="action-btn edit" (click)="onEditReportInEditor(report)" title="Редактировать">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="action-btn download" (click)="onDownloadReport(report)" title="Скачать">
                                                <i class="fas fa-download"></i>
                                            </button>
                                            <button class="action-btn duplicate" (click)="onDuplicateReport(report)" title="Дублировать">
                                                <i class="fas fa-copy"></i>
                                            </button>
                                            <button class="action-btn delete" (click)="onDeleteReport(report)" title="Удалить">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Карточки отчетов -->
                <div *ngIf="reportsView === 'cards'" class="reports-cards-view">
                    <div class="reports-grid">
                        <div class="report-card" *ngFor="let report of getFilteredReports()">
                            <div class="card-header">
                                <div class="report-icon" [ngClass]="report.type">
                                    <i class="fas" [ngClass]="{
                                        'fa-chart-line': report.type === 'financial',
                                        'fa-cogs': report.type === 'operational',
                                        'fa-tools': report.type === 'maintenance',
                                        'fa-chart-bar': report.type === 'analytics'
                                    }"></i>
                                </div>
                                <div class="card-menu">
                                    <button class="menu-btn" (click)="toggleReportMenu(report)">
                                        <i class="fas fa-ellipsis-v"></i>
                                    </button>
                                    <div class="menu-dropdown" *ngIf="report.showMenu">
                                        <button (click)="onEditReportInEditor(report)">
                                            <i class="fas fa-edit"></i>Редактировать
                                        </button>
                                        <button (click)="onDuplicateReport(report)">
                                            <i class="fas fa-copy"></i>Дублировать
                                        </button>
                                        <button (click)="onDownloadReport(report)">
                                            <i class="fas fa-download"></i>Скачать
                                        </button>
                                        <button (click)="onDeleteReport(report)" class="delete">
                                            <i class="fas fa-trash"></i>Удалить
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="card-content">
                                <h4>{{report.title}}</h4>
                                <p>{{report.description || 'Описание отсутствует'}}</p>
                                <div class="card-meta">
                                    <span class="report-type-badge" [ngClass]="report.type">
                                        {{getReportTypeName(report.type)}}
                                    </span>
                                    <span class="report-status" [ngClass]="report.status">
                                        {{getReportStatusName(report.status)}}
                                    </span>
                                </div>
                                <div class="card-footer">
                                    <span class="author">{{report.author}}</span>
                                    <span class="date">{{report.updatedDate | date:'dd.MM.yyyy'}}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Редактор отчетов -->
                <div *ngIf="reportsView === 'editor'" class="reports-editor-view">
                    <div class="editor-container">
                        <div class="editor-header">
                            <div class="editor-title">
                                <input type="text" 
                                       [value]="currentReport.title" 
                                       placeholder="Название отчета..."
                                       class="title-input">
                            </div>
                            <div class="editor-toolbar">
                                <div class="toolbar-group">
                                    <button class="toolbar-btn" 
                                            (click)="saveReport()" 
                                            [disabled]="editorState.isSaving"
                                            title="Сохранить">
                                        <i class="fas fa-save" *ngIf="!editorState.isSaving"></i>
                                        <i class="fas fa-spinner fa-spin" *ngIf="editorState.isSaving"></i>
                                    </button>
                                    <button class="toolbar-btn" (click)="previewReport()" title="Предварительный просмотр">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="toolbar-btn" (click)="exportReport()" title="Экспорт">
                                        <i class="fas fa-file-export"></i>
                                    </button>
                                    <button class="toolbar-btn" 
                                            (click)="undo()" 
                                            [disabled]="editorState.undoStack.length === 0"
                                            title="Отменить">
                                        <i class="fas fa-undo"></i>
                                    </button>
                                    <button class="toolbar-btn" 
                                            (click)="redo()" 
                                            [disabled]="editorState.redoStack.length === 0"
                                            title="Повторить">
                                        <i class="fas fa-redo"></i>
                                    </button>
                                </div>
                                <div class="toolbar-group">
                                    <select [value]="currentReport.type" class="type-select">
                                        <option value="financial">Финансовый</option>
                                        <option value="operational">Операционный</option>
                                        <option value="maintenance">Обслуживание</option>
                                        <option value="analytics">Аналитика</option>
                                    </select>
                                    <select [value]="currentReport.status" class="status-select">
                                        <option value="draft">Черновик</option>
                                        <option value="published">Опубликован</option>
                                        <option value="archived">В архиве</option>
                                    </select>
                                </div>
                                <div class="save-status" *ngIf="editorState.lastSaved && reportsView === 'editor'">
                                    <small>Сохранено: {{editorState.lastSaved | date:'HH:mm:ss'}}</small>
                                </div>
                            </div>
                        </div>

                        <div class="editor-workspace">
                            <!-- Панель инструментов редактора -->
                            <div class="editor-tools">
                                <!-- Группа: Основное форматирование -->
                                <div class="tools-section">
                                    <h5>📝 Текст</h5>
                                    <div class="tool-buttons">
                                        <button (click)="formatText('bold')" title="Жирный">
                                            <i class="fas fa-bold"></i>
                                        </button>
                                        <button (click)="formatText('italic')" title="Курсив">
                                            <i class="fas fa-italic"></i>
                                        </button>
                                        <button (click)="formatText('underline')" title="Подчеркнутый">
                                            <i class="fas fa-underline"></i>
                                        </button>
                                        <button (click)="formatText('strikethrough')" title="Зачеркнутый">
                                            <i class="fas fa-strikethrough"></i>
                                        </button>
                                    </div>
                                </div>

                                <!-- Группа: Выравнивание -->
                                <div class="tools-section">
                                    <h5>📐 Выравнивание</h5>
                                    <div class="tool-buttons">
                                        <button (click)="formatText('justifyLeft')" title="По левому краю">
                                            <i class="fas fa-align-left"></i>
                                        </button>
                                        <button (click)="formatText('justifyCenter')" title="По центру">
                                            <i class="fas fa-align-center"></i>
                                        </button>
                                        <button (click)="formatText('justifyRight')" title="По правому краю">
                                            <i class="fas fa-align-right"></i>
                                        </button>
                                        <button (click)="formatText('justifyFull')" title="По ширине">
                                            <i class="fas fa-align-justify"></i>
                                        </button>
                                    </div>
                                </div>

                                <!-- Группа: Цвета и стили -->
                                <div class="tools-section">
                                    <h5>🎨 Стили</h5>
                                    <div class="tool-buttons">
                                        <button (click)="formatText('foreColor', '#000000')" title="Цвет текста">
                                            <i class="fas fa-paint-brush"></i>
                                        </button>
                                        <button (click)="formatText('backColor', '#ffff00')" title="Фон текста">
                                            <i class="fas fa-highlighter"></i>
                                        </button>
                                        <button (click)="formatText('fontSize', '18')" title="Увеличить шрифт">
                                            <i class="fas fa-text-height"></i>
                                        </button>
                                        <button (click)="formatText('removeFormat')" title="Очистить форматирование">
                                            <i class="fas fa-eraser"></i>
                                        </button>
                                    </div>
                                </div>

                                <!-- Группа: Списки -->
                                <div class="tools-section">
                                    <h5>📋 Списки</h5>
                                    <div class="tool-buttons">
                                        <button (click)="formatText('insertUnorderedList')" title="Маркированный список">
                                            <i class="fas fa-list-ul"></i>
                                        </button>
                                        <button (click)="formatText('insertOrderedList')" title="Нумерованный список">
                                            <i class="fas fa-list-ol"></i>
                                        </button>
                                        <button (click)="formatText('indent')" title="Увеличить отступ">
                                            <i class="fas fa-indent"></i>
                                        </button>
                                        <button (click)="formatText('outdent')" title="Уменьшить отступ">
                                            <i class="fas fa-outdent"></i>
                                        </button>
                                    </div>
                                </div>

                                <!-- Группа: Таблицы и данные -->
                                <div class="tools-section">
                                    <h5>📊 Таблицы</h5>
                                    <div class="tool-buttons">
                                        <button (click)="insertElement('table')" title="Таблица">
                                            <i class="fas fa-table"></i>
                                        </button>
                                        <button (click)="insertElement('chart')" title="График">
                                            <i class="fas fa-chart-bar"></i>
                                        </button>
                                        <button (click)="insertElement('chart')" title="Круговая диаграмма">
                                            <i class="fas fa-chart-pie"></i>
                                        </button>
                                        <button (click)="insertElement('chart')" title="Линейный график">
                                            <i class="fas fa-chart-line"></i>
                                        </button>
                                    </div>
                                </div>

                                <!-- Группа: Медиа контент -->
                                <div class="tools-section">
                                    <h5>🖼️ Медиа</h5>
                                    <div class="tool-buttons">
                                        <button (click)="insertElement('image')" title="Изображение">
                                            <i class="fas fa-image"></i>
                                        </button>
                                        <button (click)="insertElement('link')" title="Ссылка">
                                            <i class="fas fa-link"></i>
                                        </button>
                                        <button (click)="insertElement('video')" title="Видео">
                                            <i class="fas fa-video"></i>
                                        </button>
                                        <button (click)="insertElement('file')" title="Файл">
                                            <i class="fas fa-file-alt"></i>
                                        </button>
                                    </div>
                                </div>

                                <!-- Группа: Разделители -->
                                <div class="tools-section">
                                    <h5>➖ Структура</h5>
                                    <div class="tool-buttons">
                                        <button (click)="insertElement('hr')" title="Горизонтальная линия">
                                            <i class="fas fa-minus"></i>
                                        </button>
                                        <button (click)="insertElement('pageBreak')" title="Разрыв страницы">
                                            <i class="fas fa-file-medical"></i>
                                        </button>
                                        <button (click)="formatText('insertParagraph')" title="Новый абзац">
                                            <i class="fas fa-paragraph"></i>
                                        </button>
                                        <button (click)="formatText('insertLineBreak')" title="Перенос строки">
                                            <i class="fas fa-level-down-alt"></i>
                                        </button>
                                    </div>
                                </div>

                                <!-- Группа: Действия -->
                                <div class="tools-section">
                                    <h5>⚡ Действия</h5>
                                    <div class="tool-buttons">
                                        <button (click)="undo()" title="Отменить" [disabled]="editorState.undoStack.length === 0">
                                            <i class="fas fa-undo"></i>
                                        </button>
                                        <button (click)="redo()" title="Повторить" [disabled]="editorState.redoStack.length === 0">
                                            <i class="fas fa-redo"></i>
                                        </button>
                                        <button (click)="formatText('selectAll')" title="Выделить все">
                                            <i class="fas fa-select-all"></i>
                                        </button>
                                        <button (click)="clearCalculation()" title="Очистить все">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>

                                <!-- Группа: Шаблоны -->
                                <div class="tools-section">
                                    <h5>📄 Шаблоны</h5>
                                    <div class="template-buttons">
                                        <button (click)="loadTemplate('financial')" class="template-btn">
                                            <i class="fas fa-chart-line"></i>
                                            Финансовый
                                        </button>
                                        <button (click)="loadTemplate('operational')" class="template-btn">
                                            <i class="fas fa-cogs"></i>
                                            Операционный
                                        </button>
                                        <button (click)="loadTemplate('analytics')" class="template-btn">
                                            <i class="fas fa-chart-bar"></i>
                                            Аналитика
                                        </button>
                                        <button (click)="loadTemplate('maintenance')" class="template-btn">
                                            <i class="fas fa-tools"></i>
                                            Техническое обслуживание
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Основная область редактора -->
                            <div class="editor-main">
                                <div class="editor-content" 
                                     contenteditable="true" 
                                     (input)="onEditorInput($event)"
                                     (focus)="onEditorFocus()"
                                     (blur)="onEditorBlur()"
                                     placeholder="Начните писать отчет...">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Диалог создания таблицы -->
                    <div *ngIf="tableEditor.showTableDialog" class="modal-overlay" (click)="tableEditor.showTableDialog = false">
                        <div class="modal-content table-dialog" (click)="$event.stopPropagation()">
                            <div class="modal-header">
                                <h4>Вставить таблицу</h4>
                                <button class="close-btn" (click)="tableEditor.showTableDialog = false">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="modal-body">
                                <div class="form-group">
                                    <label>Количество строк:</label>
                                    <input type="number" [value]="tableEditor.rows" min="1" max="20">
                                </div>
                                <div class="form-group">
                                    <label>Количество столбцов:</label>
                                    <input type="number" [value]="tableEditor.cols" min="1" max="10">
                                </div>
                                <div class="form-group">
                                    <label>
                                        <input type="checkbox" [checked]="tableEditor.hasHeaders">
                                        Добавить заголовки
                                    </label>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button class="btn btn-secondary" (click)="tableEditor.showTableDialog = false">Отмена</button>
                                <button class="btn btn-primary" (click)="insertTable()">Вставить</button>
                            </div>
                        </div>
                    </div>

                    <!-- Диалог вставки изображения -->
                    <div *ngIf="imageUpload.showImageDialog" class="modal-overlay" (click)="imageUpload.showImageDialog = false">
                        <div class="modal-content image-dialog" (click)="$event.stopPropagation()">
                            <div class="modal-header">
                                <h4>Вставить изображение</h4>
                                <button class="close-btn" (click)="imageUpload.showImageDialog = false">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="modal-body">
                                <div class="form-group">
                                    <label>URL изображения:</label>
                                    <input type="url" [value]="imageUpload.imageUrl" placeholder="https://example.com/image.jpg">
                                </div>
                                <div class="form-group">
                                    <label>Альтернативный текст:</label>
                                    <input type="text" [value]="imageUpload.imageAlt" placeholder="Описание изображения">
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Ширина (px):</label>
                                        <input type="number" [value]="imageUpload.imageWidth" min="50" max="800">
                                    </div>
                                    <div class="form-group">
                                        <label>Высота (px):</label>
                                        <input type="number" [value]="imageUpload.imageHeight" min="50" max="600">
                                    </div>
                                </div>
                                <div class="image-preview" *ngIf="imageUpload.imageUrl">
                                    <img [src]="imageUpload.imageUrl" 
                                         [alt]="imageUpload.imageAlt"
                                         [style.width.px]="imageUpload.imageWidth"
                                         [style.height.px]="imageUpload.imageHeight"
                                         style="max-width: 100%; border: 1px solid #ddd;">
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button class="btn btn-secondary" (click)="imageUpload.showImageDialog = false">Отмена</button>
                                <button class="btn btn-primary" (click)="insertImage()" [disabled]="!imageUpload.imageUrl">Вставить</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Пустое состояние -->
                <div *ngIf="reportsView !== 'editor' && getFilteredReports().length === 0" class="empty-reports">
                    <div class="empty-icon">
                        <i class="fas fa-file-alt"></i>
                    </div>
                    <h4>Отчеты не найдены</h4>
                    <p>{{reportSearchQuery ? 'Попробуйте изменить поисковый запрос' : 'Создайте первый отчет'}}</p>
                    <button class="create-first-report-btn" (click)="onCreateNewReport()">
                        <i class="fas fa-plus"></i>
                        Создать первый отчет
                    </button>
                </div>
            </section>
        </div>

        <!-- Раздел расчетов -->
        <div *ngIf="currentSection === 'calculations'">
            <!-- Калькулятор -->
            <section class="calculator-section" style="margin-bottom: 20px;">
                <div class="table-header">
                    <h3>Калькулятор</h3>
                </div>
                <div class="calculator-container">
                    <div class="calculation-types">
                        <button class="calc-type-btn" 
                                [class.active]="selectedCalculationType === 'cost'"
                                (click)="selectCalculationType('cost')">
                            <i class="fas fa-ruble-sign"></i>
                            <span>Расчет стоимости</span>
                        </button>
                        <button class="calc-type-btn" 
                                [class.active]="selectedCalculationType === 'efficiency'"
                                (click)="selectCalculationType('efficiency')">
                            <i class="fas fa-chart-line"></i>
                            <span>Эффективность</span>
                        </button>
                        <button class="calc-type-btn" 
                                [class.active]="selectedCalculationType === 'maintenance'"
                                (click)="selectCalculationType('maintenance')">
                            <i class="fas fa-tools"></i>
                            <span>Обслуживание</span>
                        </button>
                        <button class="calc-type-btn" 
                                [class.active]="selectedCalculationType === 'technical'"
                                (click)="selectCalculationType('technical')">
                            <i class="fas fa-video"></i>
                            <span>Техническое оснащение</span>
                        </button>
                    </div>

                    <div class="calculator-content" *ngIf="selectedCalculationType">
                        <!-- Калькулятор стоимости -->
                        <div *ngIf="selectedCalculationType === 'cost'" class="calculation-form">
                            <div class="form-group">
                                <label>Площадь (м²):</label>
                                <input type="number" [value]="calculatorData.cost.area" placeholder="Введите площадь">
                            </div>
                            <div class="form-group">
                                <label>Стоимость за м² (₽):</label>
                                <input type="number" [value]="calculatorData.cost.pricePerSquare" placeholder="Введите стоимость">
                            </div>
                            <div class="form-group">
                                <label>Коэффициент сложности:</label>
                                <select [value]="calculatorData.cost.complexityFactor">
                                    <option value="1">Простой (1.0)</option>
                                    <option value="1.2">Средний (1.2)</option>
                                    <option value="1.5">Сложный (1.5)</option>
                                    <option value="2">Очень сложный (2.0)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>НДС (%):</label>
                                <input type="number" [value]="calculatorData.cost.vat" placeholder="20" value="20">
                            </div>
                            <button class="calc-btn" (click)="calculateCost()">
                                <i class="fas fa-calculator"></i>
                                Рассчитать стоимость
                            </button>
                        </div>

                        <!-- Калькулятор эффективности -->
                        <div *ngIf="selectedCalculationType === 'efficiency'" class="calculation-form">
                            <div class="form-group">
                                <label>Доходы (₽):</label>
                                <input type="number" [value]="calculatorData.efficiency.income" placeholder="Введите доходы">
                            </div>
                            <div class="form-group">
                                <label>Расходы (₽):</label>
                                <input type="number" [value]="calculatorData.efficiency.expenses" placeholder="Введите расходы">
                            </div>
                            <div class="form-group">
                                <label>Инвестиции (₽):</label>
                                <input type="number" [value]="calculatorData.efficiency.investments" placeholder="Введите инвестиции">
                            </div>
                            <div class="form-group">
                                <label>Период (месяцев):</label>
                                <input type="number" [value]="calculatorData.efficiency.period" placeholder="12" value="12">
                            </div>
                            <button class="calc-btn" (click)="calculateEfficiency()">
                                <i class="fas fa-chart-line"></i>
                                Рассчитать эффективность
                            </button>
                        </div>

                        <!-- Калькулятор обслуживания -->
                        <div *ngIf="selectedCalculationType === 'maintenance'" class="calculation-form">
                            <div class="form-group">
                                <label>Количество оборудования:</label>
                                <input type="number" [value]="calculatorData.maintenance.equipmentCount" placeholder="Введите количество">
                            </div>
                            <div class="form-group">
                                <label>Стоимость обслуживания за единицу (₽):</label>
                                <input type="number" [value]="calculatorData.maintenance.costPerUnit" placeholder="Введите стоимость">
                            </div>
                            <div class="form-group">
                                <label>Периодичность (дней):</label>
                                <input type="number" [value]="calculatorData.maintenance.frequency" placeholder="30" value="30">
                            </div>
                            <div class="form-group">
                                <label>Тип обслуживания:</label>
                                <select [value]="calculatorData.maintenance.maintenanceType">
                                    <option value="preventive">Профилактическое</option>
                                    <option value="corrective">Корректирующее</option>
                                    <option value="emergency">Экстренное</option>
                                </select>
                            </div>
                            <button class="calc-btn" (click)="calculateMaintenance()">
                                <i class="fas fa-tools"></i>
                                Рассчитать обслуживание
                            </button>
                        </div>

                        <!-- Калькулятор технического оснащения -->
                        <div *ngIf="selectedCalculationType === 'technical'" class="calculation-form">
                            <div class="form-group">
                                <label>Количество камер:</label>
                                <input type="number" [value]="calculatorData.technical.cameraCount" placeholder="Введите количество камер">
                            </div>
                            <div class="form-group">
                                <label>Стоимость одной камеры (₽):</label>
                                <input type="number" [value]="calculatorData.technical.cameraPrice" placeholder="Введите стоимость камеры">
                            </div>
                            <div class="form-group">
                                <label>Количество серверов:</label>
                                <input type="number" [value]="calculatorData.technical.serverCount" placeholder="Введите количество серверов">
                            </div>
                            <div class="form-group">
                                <label>Стоимость одного сервера (₽):</label>
                                <input type="number" [value]="calculatorData.technical.serverPrice" placeholder="Введите стоимость сервера">
                            </div>
                            <div class="form-group">
                                <label>Длина провода (м):</label>
                                <input type="number" [value]="calculatorData.technical.cableLength" placeholder="Введите длину провода">
                            </div>
                            <div class="form-group">
                                <label>Стоимость провода за метр (₽):</label>
                                <input type="number" [value]="calculatorData.technical.cablePricePerMeter" placeholder="Введите стоимость за метр">
                            </div>
                            <div class="form-group">
                                <label>Тип инсталляции:</label>
                                <select [value]="calculatorData.technical.installationType" (change)="calculatorData.technical.installationType = $any($event.target).value">
                                    <option value="basic">Базовая установка</option>
                                    <option value="professional">Профессиональная установка</option>
                                    <option value="premium">Премиум установка</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Стоимость работ (₽):</label>
                                <input type="number" [value]="calculatorData.technical.installationCost" (input)="calculatorData.technical.installationCost = Number($any($event.target).value)" placeholder="Введите стоимость работ">
                            </div>
                            <button class="calc-btn" (click)="calculateTechnical()">
                                <i class="fas fa-video"></i>
                                Рассчитать техническое оснащение
                            </button>
                        </div>

                        <!-- Результаты расчетов -->
                        <div class="calculation-result" *ngIf="calculationResult">
                            <h4><i class="fas fa-chart-bar"></i> Результат расчета</h4>
                            <div class="result-content">
                                <div class="result-item" *ngFor="let item of calculationResult.details">
                                    <span class="result-label">{{item.label}}:</span>
                                    <span class="result-value">{{item.value}}</span>
                                </div>
                                <div class="result-total">
                                    <span class="total-label">{{calculationResult.totalLabel}}:</span>
                                    <span class="total-value">{{calculationResult.totalValue}}</span>
                                </div>
                            </div>
                            <div class="result-actions">
                                <button class="save-btn" (click)="saveCalculation()">
                                    <i class="fas fa-save"></i>
                                    Сохранить расчет
                                </button>
                                <button class="clear-btn" (click)="clearCalculation()">
                                    <i class="fas fa-trash"></i>
                                    Очистить
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Таблица сохраненных расчетов -->
            <section class="data-table">
                <div class="table-header">
                    <div class="header-left">
                        <h3>Сохраненные расчеты</h3>
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" 
                                   [value]="calculationSearchQuery" 
                                   (input)="calculationSearchQuery = $any($event.target).value; onCalculationSearch($any($event.target).value)"
                                   placeholder="Поиск по названию или типу...">
                        </div>
                    </div>
                </div>
                <div *ngIf="!filteredCalculations || filteredCalculations.length === 0" class="no-data">
                    <i class="fas fa-search"></i>
                    <p>{{calculationSearchQuery ? 'Ничего не найдено' : 'Нет данных о расчетах'}}</p>
                </div>
                <table *ngIf="filteredCalculations && filteredCalculations.length > 0">
                    <thead>
                        <tr>
                            <th>Название</th>
                            <th>Тип</th>
                            <th>Дата</th>
                            <th>Результат</th>
                            <th>Действия</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let calculation of filteredCalculations">
                            <td>{{calculation.name}}</td>
                            <td>
                                <span class="badge" [ngClass]="calculation.type">
                                    {{calculation.type === 'cost' ? 'Стоимость' : 
                                      calculation.type === 'efficiency' ? 'Эффективность' : 
                                      calculation.type === 'maintenance' ? 'Обслуживание' : 
                                      calculation.type === 'technical' ? 'Техническое оснащение' : calculation.type}}
                                </span>
                            </td>
                            <td>{{calculation.date | date:'dd.MM.yyyy'}}</td>
                            <td>
                                <span class="result" [ngClass]="calculation.type">
                                    {{calculation.result | number:'1.2-2'}}
                                    {{calculation.type === 'efficiency' ? '%' : '₽'}}
                                </span>
                            </td>
                            <td>
                                <div class="action-buttons">
                                    <button class="action-btn view" (click)="onViewCalculation(calculation)">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="action-btn edit" (click)="onEditCalculation(calculation)">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="action-btn delete" (click)="onDeleteCalculation(calculation)">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </section>
        </div>

        <!-- Раздел отзывов -->
        <div *ngIf="currentSection === 'reviews'">
            <div class="reviews-container">
                <div class="reviews-header">
                    <h3>📝 Отзывы клиентов</h3>
                    <div class="reviews-header-info">
                        <p>Управление отзывами от клиентов</p>
                    </div>
                </div>

                <!-- Статистика отзывов -->
                <div class="reviews-stats">
                    <div class="review-stat-card total">
                        <div class="review-rating-display">
                            <div class="review-rating-number">{{reviews.length}}</div>
                        </div>
                        <div class="review-stat-label">Всего отзывов</div>
                    </div>
                    
                    <div class="review-stat-card positive">
                        <div class="review-rating-display">
                            <div class="review-stars">
                                <span class="review-star">★</span>
                                <span class="review-star">★</span>
                                <span class="review-star">★</span>
                                <span class="review-star">★</span>
                                <span class="review-star">★</span>
                            </div>
                            <div class="review-rating-number">{{getPositiveReviewsCount()}}</div>
                        </div>
                        <div class="review-stat-label">Положительных (4-5★)</div>
                    </div>
                    
                    <div class="review-stat-card negative">
                        <div class="review-rating-display">
                            <div class="review-stars">
                                <span class="review-star">★</span>
                                <span class="review-star">★</span>
                                <span class="review-star empty">★</span>
                                <span class="review-star empty">★</span>
                                <span class="review-star empty">★</span>
                            </div>
                            <div class="review-rating-number">{{getNegativeReviewsCount()}}</div>
                        </div>
                        <div class="review-stat-label">Негативных (1-2★)</div>
                    </div>
                    
                    <div class="review-stat-card average">
                        <div class="review-rating-display">
                            <div class="review-rating-number">{{getAverageRating()}}</div>
                            <div class="review-stars">
                                <span class="review-star" *ngFor="let star of [].constructor(Math.floor(getAverageRating()))">★</span>
                                <span class="review-star empty" *ngFor="let star of [].constructor(5 - Math.floor(getAverageRating()))">★</span>
                            </div>
                        </div>
                        <div class="review-stat-label">Средняя оценка</div>
                    </div>
                </div>

                <!-- Список отзывов -->
                <div class="reviews-list">
                    <div class="reviews-filters">
                        <div class="rating-filter">
                            <select [value]="selectedReviewRating" (change)="selectedReviewRating = $any($event.target).value; filterReviewsByRating()">
                                <option value="">Все оценки</option>
                                <option value="5">5 звезд</option>
                                <option value="4">4 звезды</option>
                                <option value="3">3 звезды</option>
                                <option value="2">2 звезды</option>
                                <option value="1">1 звезда</option>
                            </select>
                        </div>
                        <div class="date-filter">
                            <select [value]="selectedReviewPeriod" (change)="selectedReviewPeriod = $any($event.target).value; filterReviewsByDate()">
                                <option value="">Все время</option>
                                <option value="today">Сегодня</option>
                                <option value="week">За неделю</option>
                                <option value="month">За месяц</option>
                            </select>
                        </div>
                        <div class="status-filter">
                            <select [value]="selectedReviewStatus" (change)="selectedReviewStatus = $any($event.target).value; filterReviewsByStatus()">
                                <option value="">Все статусы</option>
                                <option value="pending">На модерации</option>
                                <option value="approved">Одобрено</option>
                                <option value="rejected">Отклонено</option>
                            </select>
                        </div>
                    </div>

                    <div class="review-item" *ngFor="let review of getFilteredReviews()">
                        <div class="review-header">
                            <div class="review-author">
                                <div class="review-avatar">{{review.author.charAt(0).toUpperCase()}}</div>
                                <div class="review-author-info">
                                    <h5>{{review.author}}</h5>
                                    <div class="review-date">{{review.date | date:'d MMMM yyyy, HH:mm'}}</div>
                                </div>
                            </div>
                            <div class="review-rating-display">
                                <div class="review-stars">
                                    <span class="review-star" *ngFor="let star of [].constructor(review.rating)">★</span>
                                    <span class="review-star empty" *ngFor="let star of [].constructor(5 - review.rating)">★</span>
                                </div>
                                <span class="review-status" [ngClass]="review.status">
                                    {{review.status === 'pending' ? 'На модерации' : 
                                      review.status === 'approved' ? 'Одобрено' : 'Отклонено'}}
                                </span>
                            </div>
                        </div>
                        
                        <div class="review-content">{{review.content}}</div>
                        
                        <div class="review-actions" *ngIf="review.status === 'pending'">
                            <button class="review-action-btn approve" (click)="onApproveReview(review)">
                                <i class="fas fa-check"></i> Одобрить
                            </button>
                            <button class="review-action-btn reject" (click)="onRejectReview(review)">
                                <i class="fas fa-times"></i> Отклонить
                            </button>
                            <button class="review-action-btn respond" (click)="onAddResponse(review)">
                                <i class="fas fa-reply"></i> Ответить
                            </button>
                        </div>
                        
                        <div class="review-response" *ngIf="review.response">
                            <div class="response-header">
                                <strong>Ответ администратора:</strong>
                            </div>
                            <div class="response-content">{{review.response}}</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Раздел обратной связи -->
        <div *ngIf="currentSection === 'feedback'">
            <div class="feedback-container">
                <div class="feedback-header">
                    <h3>💬 Обратная связь</h3>
                    <div class="feedback-header-info">
                        <p>Управление сообщениями от клиентов</p>
                    </div>
                </div>

                <!-- Статистика обратной связи -->
                <div class="feedback-stats">
                    <div class="feedback-stat-card new">
                        <div class="stat-icon">📩</div>
                        <div class="stat-number">{{getNewFeedbacksCount()}}</div>
                        <div class="stat-label">Новых сообщений</div>
                    </div>
                    
                    <div class="feedback-stat-card in-progress">
                        <div class="stat-icon">⏳</div>
                        <div class="stat-number">{{getInProgressFeedbacksCount()}}</div>
                        <div class="stat-label">В работе</div>
                    </div>
                    
                    <div class="feedback-stat-card resolved">
                        <div class="stat-icon">✅</div>
                        <div class="stat-number">{{getResolvedFeedbacksCount()}}</div>
                        <div class="stat-label">Решенных</div>
                    </div>
                    
                    <div class="feedback-stat-card total">
                        <div class="stat-icon">📊</div>
                        <div class="stat-number">{{feedbacks.length}}</div>
                        <div class="stat-label">Всего обращений</div>
                    </div>
                </div>

                <!-- Макет с двумя панелями -->
                <div class="feedback-layout">
                    <!-- Левая панель - список сообщений -->
                    <div class="feedback-list">
                        <div class="feedback-filters">
                            <select [value]="selectedFeedbackStatus" (change)="selectedFeedbackStatus = $any($event.target).value; filterFeedbackByStatus()">
                                <option value="">Все статусы</option>
                                <option value="new">Новые</option>
                                <option value="in_progress">В работе</option>
                                <option value="resolved">Решенные</option>
                                <option value="closed">Закрытые</option>
                            </select>
                            <select [value]="selectedFeedbackPriority" (change)="selectedFeedbackPriority = $any($event.target).value; filterFeedbackByPriority()">
                                <option value="">Все приоритеты</option>
                                <option value="high">Высокий</option>
                                <option value="medium">Средний</option>
                                <option value="low">Низкий</option>
                            </select>
                        </div>

                        <div class="feedback-item" *ngFor="let feedback of getFilteredFeedbacks()" 
                             [class.active]="selectedFeedback?.id === feedback.id"
                             (click)="onSelectFeedback(feedback)">
                            <div class="feedback-item-header">
                                <div class="feedback-author-info">
                                    <div class="feedback-avatar">{{feedback.author.charAt(0).toUpperCase()}}</div>
                                    <div class="feedback-details">
                                        <h5>{{feedback.author}}</h5>
                                        <p class="feedback-email">{{feedback.email}}</p>
                                        <p class="feedback-phone">{{feedback.phone}}</p>
                                    </div>
                                </div>
                                <div class="feedback-meta">
                                    <span class="feedback-date">{{feedback.date | date:'d MMM'}}</span>
                                    <span class="feedback-status" [ngClass]="feedback.status">
                                        {{feedback.status === 'new' ? 'Новое' : 
                                          feedback.status === 'in_progress' ? 'В работе' : 
                                          feedback.status === 'resolved' ? 'Решено' : 'Закрыто'}}
                                    </span>
                                    <span class="feedback-priority" [ngClass]="feedback.priority">
                                        {{feedback.priority === 'high' ? '🔴' : 
                                          feedback.priority === 'medium' ? '🟡' : '🟢'}}
                                    </span>
                                </div>
                            </div>
                            <div class="feedback-subject">{{feedback.subject}}</div>
                            <div class="feedback-preview">{{feedback.message.substring(0, 100)}}...</div>
                        </div>
                    </div>

                    <!-- Правая панель - детали сообщения -->
                    <div class="feedback-detail" *ngIf="selectedFeedback">
                        <div class="feedback-detail-header">
                            <div class="feedback-detail-title">
                                <h3>{{selectedFeedback.subject}}</h3>
                                <div class="feedback-detail-meta">
                                    <span class="author">{{selectedFeedback.author}}</span>
                                    <span class="date">{{selectedFeedback.date | date:'d MMMM yyyy, HH:mm'}}</span>
                                    <span class="status" [ngClass]="selectedFeedback.status">
                                        {{selectedFeedback.status === 'new' ? 'Новое' : 
                                          selectedFeedback.status === 'in_progress' ? 'В работе' : 
                                          selectedFeedback.status === 'resolved' ? 'Решено' : 'Закрыто'}}
                                    </span>
                                </div>
                            </div>
                            <div class="feedback-actions">
                                <button class="action-btn primary" 
                                        (click)="onUpdateStatus(selectedFeedback)">
                                    {{selectedFeedback.status === 'new' ? '⏳ Взять в работу' : 
                                      selectedFeedback.status === 'in_progress' ? '✅ Решено' : 
                                      selectedFeedback.status === 'resolved' ? '🔒 Закрыть' : '🔄 Открыть'}}
                                </button>
                                <button class="action-btn danger" 
                                        (click)="onDeleteFeedback(selectedFeedback)">
                                    <i class="fas fa-trash"></i> Удалить
                                </button>
                            </div>
                        </div>

                        <!-- Контактная информация -->
                        <div class="feedback-contact-info">
                            <div class="contact-item">
                                <i class="fas fa-envelope"></i>
                                <span>{{selectedFeedback.email}}</span>
                                <a [href]="'mailto:' + selectedFeedback.email" class="contact-link">Написать</a>
                            </div>
                            <div class="contact-item">
                                <i class="fas fa-phone"></i>
                                <span>{{selectedFeedback.phone}}</span>
                                <a [href]="'tel:' + selectedFeedback.phone" class="contact-link">Позвонить</a>
                            </div>
                        </div>

                        <!-- Сообщения -->
                        <div class="feedback-messages">
                            <div class="message user">
                                <div class="message-header">
                                    <span class="message-author">{{selectedFeedback.author}}</span>
                                    <span class="message-date">{{selectedFeedback.date | date:'d MMMM yyyy, HH:mm'}}</span>
                                </div>
                                <div class="message-content">{{selectedFeedback.message}}</div>
                            </div>
                            
                            <div class="message admin" *ngFor="let response of selectedFeedback.responses">
                                <div class="message-header">
                                    <span class="message-author">{{response.author}}</span>
                                    <span class="message-date">{{response.date | date:'d MMMM yyyy, HH:mm'}}</span>
                                    <span class="admin-badge">Администратор</span>
                                </div>
                                <div class="message-content">{{response.message}}</div>
                            </div>
                        </div>
                        
                        <!-- Поле для ответа -->
                        <div class="feedback-response">
                            <div class="response-header">
                                <i class="fas fa-reply"></i>
                                <span>Ответить клиенту</span>
                            </div>
                            <textarea ngModel="{{newResponse}}" 
                                      (input)="newResponse = $any($event.target).value"
                                      placeholder="Введите ваш ответ клиенту..."
                                      rows="4"></textarea>
                            <div class="response-actions">
                                <button class="send-btn" (click)="onSendResponse()" [disabled]="!newResponse || !newResponse.trim()">
                                    <i class="fas fa-paper-plane"></i>
                                    Отправить ответ
                                </button>
                                <button class="template-btn" (click)="useResponseTemplate()">
                                    <i class="fas fa-file-alt"></i>
                                    Использовать шаблон
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Плейсхолдер когда не выбрано сообщение -->
                    <div class="feedback-placeholder" *ngIf="!selectedFeedback">
                        <div class="placeholder-content">
                            <i class="fas fa-comments placeholder-icon"></i>
                            <h3>Выберите сообщение</h3>
                            <p>Выберите сообщение из списка слева для просмотра деталей и ответа клиенту</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Раздел настроек -->
        <div *ngIf="currentSection === 'settings'">
            <section class="data-table">
                <div class="table-header">
                    <h3>Настройки системы</h3>
                </div>
                <div class="settings-container">
                    <div class="settings-group" *ngFor="let category of settingCategories">
                        <h4>
                            <i class="fas" [ngClass]="{
                                'fa-cog': category.id === 'system',
                                'fa-bell': category.id === 'notification',
                                'fa-shield-alt': category.id === 'security',
                                'fa-paint-brush': category.id === 'appearance'
                            }"></i>
                            {{category.title}}
                        </h4>
                        <div class="settings-list">
                            <div class="setting-item" *ngFor="let setting of getSettingsByCategory(category.id)">
                                <div class="setting-info">
                                    <span class="setting-name">{{setting.key}}</span>
                                    <span class="setting-description">{{setting.description}}</span>
                                </div>
                                <div class="setting-control">
                                    <ng-container [ngSwitch]="setting.type || 'text'">
                                        <!-- Булевые настройки -->
                                        <label class="switch" *ngSwitchCase="'boolean'">
                                            <input type="checkbox" 
                                                   [checked]="setting.value === 'true'"
                                                   (change)="setting.value = $any($event.target).checked; onSettingChange(setting)">
                                            <span class="slider"></span>
                                        </label>
                                        
                                        <!-- Числовые настройки -->
                                        <input type="number" 
                                               *ngSwitchCase="'number'"
                                               [value]="setting.value"
                                               (input)="setting.value = $any($event.target).value; onSettingChange(setting)"
                                               class="setting-input">
                                        
                                        <!-- Выбор из списка -->
                                        <select *ngSwitchCase="'select'"
                                                [value]="setting.value"
                                                (change)="setting.value = $any($event.target).value; onSettingChange(setting)"
                                                class="setting-select">
                                            <ng-container [ngSwitch]="setting.key">
                                                <ng-container *ngSwitchCase="'backup_frequency'">
                                                    <option value="daily">Ежедневно</option>
                                                    <option value="weekly">Еженедельно</option>
                                                    <option value="monthly">Ежемесячно</option>
                                                </ng-container>
                                                <ng-container *ngSwitchCase="'default_language'">
                                                    <option value="ru">Русский</option>
                                                    <option value="en">English</option>
                                                </ng-container>
                                                <ng-container *ngSwitchDefault>
                                                    <option [value]="setting.value">{{setting.value}}</option>
                                                </ng-container>
                                            </ng-container>
                                        </select>
                                        
                                        <!-- Цвет -->
                                        <input type="color" 
                                               *ngSwitchCase="'color'"
                                               [value]="setting.value"
                                               (input)="setting.value = $any($event.target).value; onSettingChange(setting)"
                                               class="setting-color">
                                        
                                        <!-- Текстовые настройки (по умолчанию) -->
                                        <input type="text" 
                                               *ngSwitchDefault
                                               [value]="setting.value"
                                               (input)="setting.value = $any($event.target).value; onSettingChange(setting)"
                                               class="setting-input">
                                    </ng-container>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <app-add-employee-modal
            *ngIf="showAddEmployeeModal"
            [employeeToEdit]="selectedEmployee"
            [isDarkTheme]="isDarkTheme"
            (close)="onCloseAddEmployeeModal()"
            (employeeAdded)="onEmployeeAdded($any($event))"
            (employeeUpdated)="onEmployeeUpdated($any($event))">
        </app-add-employee-modal>

        <!-- Модальное окно добавления/редактирования объекта -->
        <app-add-facility-modal 
            *ngIf="showAddFacilityModal" 
            [facilityToEdit]="selectedFacility"
            [isDarkTheme]="isDarkTheme"
            (close)="onCloseAddFacilityModal()"
            (facilityAdded)="onFacilityAdded($any($event))"
            (facilityUpdated)="onFacilityUpdated($any($event))">
        </app-add-facility-modal>

        <!-- Модальное окно добавления/редактирования новостей -->
        <app-add-news-modal
            *ngIf="showAddNewsModal"
            [newsToEdit]="selectedNews"
            [isDarkTheme]="isDarkTheme"
            (close)="onCloseAddNewsModal()"
            (newsAdded)="onNewsAdded($any($event))"
            (newsUpdated)="onNewsUpdated($any($event))">
        </app-add-news-modal>

        <!-- Модальное окно добавления/редактирования оборудования -->
        <app-add-equipment-modal
            *ngIf="showAddEquipmentModal"
            [equipmentToEdit]="selectedEquipment || undefined"
            (equipmentAdded)="onEquipmentAdded($any($event))"
            (equipmentUpdated)="onEquipmentUpdated($any($event))"
            (close)="onCloseAddEquipmentModal()">
        </app-add-equipment-modal>
    </main>

    <!-- Модальное окно для добавления/редактирования транзакции -->
    <div class="modal-overlay" *ngIf="showAddTransactionModal" (click)="onCloseTransactionModal()">
        <div class="modal-content" (click)="$event.stopPropagation()">
            <div class="modal-header">
                <h3>{{selectedTransaction ? 'Редактировать транзакцию' : 'Добавить транзакцию'}}</h3>
                <button class="close-btn" (click)="onCloseTransactionModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form #transactionForm="ngForm" (ngSubmit)="onTransactionSaved(transactionData)">
                    <div class="form-group">
                        <label for="transactionDate">Дата</label>
                        <input type="date" id="transactionDate" name="date" 
                               [(ngModel)]="transactionData.date" required>
                    </div>
                    <div class="form-group">
                        <label for="transactionDescription">Описание</label>
                        <input type="text" id="transactionDescription" name="description" 
                               [(ngModel)]="transactionData.description" required>
                    </div>
                    <div class="form-group">
                        <label for="transactionCategory">Категория</label>
                        <input type="text" id="transactionCategory" name="category" 
                               [(ngModel)]="transactionData.category" required>
                    </div>
                    <div class="form-group">
                        <label for="transactionType">Тип</label>
                        <select id="transactionType" name="type" 
                                [(ngModel)]="transactionData.type" required>
                            <option value="income">Доход</option>
                            <option value="expense">Расход</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="transactionAmount">Сумма</label>
                        <input type="number" id="transactionAmount" name="amount" 
                               [(ngModel)]="transactionData.amount" required>
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="cancel-btn" (click)="onCloseTransactionModal()">
                            Отмена
                        </button>
                        <button type="submit" class="save-btn" [disabled]="!transactionForm.valid">
                            {{selectedTransaction ? 'Обновить' : 'Создать'}}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Модальное окно для добавления/редактирования бюджета -->
    <div class="modal-overlay" *ngIf="showBudgetModal" (click)="onCloseBudgetModal()">
        <div class="modal-content" (click)="$event.stopPropagation()">
            <div class="modal-header">
                <h3>{{selectedBudget ? 'Редактировать бюджет' : 'Создать бюджет'}}</h3>
                <button class="close-btn" (click)="onCloseBudgetModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form #budgetForm="ngForm" (ngSubmit)="onBudgetSaved(budgetData)">
                    <div class="form-group">
                        <label for="budgetName">Название</label>
                        <input type="text" id="budgetName" name="name" 
                               [(ngModel)]="budgetData.name" required>
                    </div>
                    <div class="form-group">
                        <label for="budgetCategory">Категория</label>
                        <input type="text" id="budgetCategory" name="category" 
                               [(ngModel)]="budgetData.category" required>
                    </div>
                    <div class="form-group">
                        <label for="budgetPeriod">Период</label>
                        <select id="budgetPeriod" name="period" 
                                [(ngModel)]="budgetData.period" required>
                            <option value="month">Месяц</option>
                            <option value="quarter">Квартал</option>
                            <option value="year">Год</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="budgetLimit">Лимит</label>
                        <input type="number" id="budgetLimit" name="limit" 
                               [(ngModel)]="budgetData.limit" required>
                    </div>
                    <div class="form-group">
                        <label for="budgetSpent">Потрачено</label>
                        <input type="number" id="budgetSpent" name="spent" 
                               [(ngModel)]="budgetData.spent">
                    </div>
                    <div class="form-group">
                        <label for="budgetStartDate">Дата начала</label>
                        <input type="date" id="budgetStartDate" name="startDate" 
                               [(ngModel)]="budgetData.startDate" required>
                    </div>
                    <div class="form-group">
                        <label for="budgetEndDate">Дата окончания</label>
                        <input type="date" id="budgetEndDate" name="endDate" 
                               [(ngModel)]="budgetData.endDate" required>
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="cancel-btn" (click)="onCloseBudgetModal()">
                            Отмена
                        </button>
                        <button type="submit" class="save-btn" [disabled]="!budgetForm.valid">
                            {{selectedBudget ? 'Обновить' : 'Создать'}}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
